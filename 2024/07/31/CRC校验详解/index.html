<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CRC校验详解 | narutozxp</title><meta name="keywords" content="CRC"><meta name="author" content="narutozxp"><meta name="copyright" content="narutozxp"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="摘要 本文首先阐述了错误检测的目的以及纠错复杂度，然后以此引出了CRC背后的基础思想。为了能够充分理解CRC运算所基于的运算系统，本文还介绍了抽象代数中的相关概念（多项式环、素域、扩域）。然后描述了如何选取CRC的多项式。有了这些基本概念之后，本文介绍了三种CRC的实现，对于同一个CRC算法，其中SIMPLE于TABLE ALGORITHM所使用的寄存器初值是一样的，只是后者更高效一点，而DIRE">
<meta property="og:type" content="article">
<meta property="og:title" content="CRC校验详解">
<meta property="og:url" content="https://www.narutozxp.top/2024/07/31/CRC%E6%A0%A1%E9%AA%8C%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="narutozxp">
<meta property="og:description" content="摘要 本文首先阐述了错误检测的目的以及纠错复杂度，然后以此引出了CRC背后的基础思想。为了能够充分理解CRC运算所基于的运算系统，本文还介绍了抽象代数中的相关概念（多项式环、素域、扩域）。然后描述了如何选取CRC的多项式。有了这些基本概念之后，本文介绍了三种CRC的实现，对于同一个CRC算法，其中SIMPLE于TABLE ALGORITHM所使用的寄存器初值是一样的，只是后者更高效一点，而DIRE">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.narutozxp.top/img/25.jpg">
<meta property="article:published_time" content="2024-07-31T15:51:02.000Z">
<meta property="article:modified_time" content="2024-08-27T11:39:19.000Z">
<meta property="article:author" content="narutozxp">
<meta property="article:tag" content="CRC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.narutozxp.top/img/25.jpg"><link rel="shortcut icon" href="/img/myself.jpg"><link rel="canonical" href="https://www.narutozxp.top/2024/07/31/CRC%E6%A0%A1%E9%AA%8C%E8%AF%A6%E8%A7%A3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Great%20Vibes" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CRC校验详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-27 11:39:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script> <link rel="stylesheet" href="/css/custom.css"> <link rel="stylesheet" href="/css/font.css"> <script data-pjax src="https://wavedrom.com/wavedrom.min.js" type="text/javascript"></script> <script data-pjax src="https://wavedrom.com/skins/default.js" type="text/javascript"></script> <script data-pjax src="https://wavedrom.com/skins/dark.js" type="text/javascript"></script> <script data-pjax src="https://wavedrom.com/skins/narrow.js" type="text/javascript"></script> <script data-pjax src="https://wavedrom.com/skins/lowkey.js" type="text/javascript"></script> <script data-pjax src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js" type="text/javascript"></script> <script data-pjax src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js" type="text/javascript"></script> <script data-pjax src="https://cdn.jsdelivr.net/npm/abcjs/dist/abcjs-basic-min.js" type="text/javascript"></script> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/abcjs/abcjs-audio.css"/> <script defer data-pjax src="https://cn.vercount.one/js" type="text/javascript"></script>
<script data-pjax type="text/javascript"> document.addEventListener('pjax:complete', WaveDrom.ProcessAll); document.addEventListener('pjax:complete', mermaid.init); </script> <script data-pjax type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.5.0/style.css" /> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"> <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script> <meting-js id="2217718183" server="netease" type="playlist" autoplay = "false" api = "https://v.iarc.top/?server=:server&type=:type&id=:id&r=:r" mini = "true" fixed = "true" loop = "all" order = 'random' list-folded = "true"> </meting-js><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/myself.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/25.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">narutozxp</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CRC校验详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-31T15:51:02.000Z" title="发表于 2024-07-31 15:51:02">2024-07-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-27T11:39:19.000Z" title="更新于 2024-08-27 11:39:19">2024-08-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CRC/">CRC</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">17.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>71分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CRC校验详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="摘要">摘要</h1>
<p>本文首先阐述了错误检测的目的以及纠错复杂度，然后以此引出了CRC背后的基础思想。为了能够充分理解CRC运算所基于的运算系统，本文还介绍了抽象代数中的相关概念（多项式环、素域、扩域）。然后描述了如何选取CRC的多项式。有了这些基本概念之后，本文介绍了三种CRC的实现，对于同一个CRC算法，其中SIMPLE于TABLE ALGORITHM所使用的寄存器初值是一样的，只是后者更高效一点，而DIRECT TABLE ALGORITHM则更高效，而且寄存器初值也与前两种不一样（通常CRC算法所说的初值就是指的这个算法的寄存器初值），因此需要进行初值转换。在此之后还介绍了一些决定CRC算法的其他参数，并且以此定义一个名为Rocksoft™的参数化模型，用以精确描述CRC算法。最后本文还包含了CRC算法的C实现。</p>
<p>本文很大程度上参考了<a target="_blank" rel="noopener" href="https://www.zlib.net/crc_v3.txt">A PAINLESS GUIDE TO CRC ERROR DETECTION ALGORITHMS</a>，在其中加入了一些自己的理解。因此非常感谢Ross N. Williams.大佬</p>
<h1 id="错误检测的目的">错误检测的目的</h1>
<p>发射机产生的数据，在经过带有噪声的信道之后，会被噪声所污染，从而导致接收机接收到错误的数据。为了解决这一情况，通常可以使用一个校验算法函数<span class="math inline">\(f(Msg)\)</span>，该函通常是一个关于数据原文的函数，产生一个校验和<span class="math inline">\(CheckSum\)</span>。然后接收方即可以通过实现约定好的算法，验证<span class="math inline">\(Msg\)</span>与<span class="math inline">\(CheckSum\)</span>之间的关系。</p>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"CheckSum",type:1},
        {bits:24,name:"Msg",type:6}
    ]
}</script>
<p>例如，如若定义<span class="math inline">\(CheckSum = f(Msg) = sum(int(byte))\mod 256\)</span>，则整个校验流程如下图，接收方可以计算出<span class="math inline">\((6+27+4) \mod 256 \neq 33\)</span>，因此可以判断出数据收到了损坏。</p>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"4",type:6},
        {bits:8,name:"23",type:6},
        {bits:8,name:"6",type:6}
    ],config:{label:{left:"Msg"}},
}</script>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"33",type:1},
        {bits:8,name:"4",type:6},
        {bits:8,name:"23",type:6},
        {bits:8,name:"6",type:6}
    ],config:{label:{left:"Tran"}}
}</script>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"33",type:1},
        {bits:8,name:"4",type:6},
        {bits:8,name:"27",type:6},
        {bits:8,name:"6",type:6}
    ],config:{label:{left:"Recv"}}
}</script>
<p>但是如果<span class="math inline">\(Msg\)</span>与<span class="math inline">\(CheckSum\)</span>都被改变了，而且改变之后的值能够与校验函数<span class="math inline">\(f\)</span>对应上，就会使接收方误以为数据正确，从而引发故障。不幸的是，这种可能性是完全不能够避免的，最好的办法就是增加校验中的信息量来减小其发生的概率。</p>
<h1 id="纠错复杂度">纠错复杂度</h1>
<p>上述的算法的问题在于其太过于简单，如果数据受到了随机污染，则会接收方有<span class="math inline">\(\frac{1}{256}\)</span>的概率无法检测处错误。例如：</p>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"4",type:6},
        {bits:8,name:"23",type:6},
        {bits:8,name:"6",type:6}
    ],config:{label:{left:"Msg"}},
}</script>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"33",type:1},
        {bits:8,name:"4",type:6},
        {bits:8,name:"23",type:6},
        {bits:8,name:"6",type:6}
    ],config:{label:{left:"Tran"}}
}</script>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"33",type:1},
        {bits:8,name:"5",type:6},
        {bits:8,name:"20",type:6},
        {bits:8,name:"8",type:6}
    ],config:{label:{left:"Recv"}}
}</script>
<p>为了增加该校验算法，我们可以将存储校验和的寄存器从8bit增加到16bit，然后使用模<span class="math inline">\(2^{16}\)</span>的加法作为校验算法。这样无法检测出错误的概率就降低到了<span class="math inline">\(\frac{1}{2^{16}}\)</span>。虽然这是一个好的改进，但是依然无法解决本例的错误。因为该校验算法是求和，不够随机——每次求和的时候，不管校验寄存器有多宽，都只会影响校验寄存器中大约一个字节的数据。从而我们可以从以下两个方面来增强校验算法：</p>
<ul>
<li><strong>WIDTH:</strong> 校验寄存器的宽度——减小碰撞的概率</li>
<li><strong>CHAOS:</strong> 改进校验算法，使得每个字节都有潜力去改变校验急窜去中的任意数量bits</li>
</ul>
<h1 id="crc算法背后的基础思想">CRC算法背后的基础思想</h1>
<p>虽然加法不够具有随机性，但是只要除数的宽度与校验寄存器的宽度一样，除法就能满足要求。而CRC算法的基本思想是简单地将消息视为一个巨大的二进制数，将其除以另一个固定二进制数，并将该除法的余数作为校验和。收到消息后，接收器可以执行相同的除法，并将余数与“校验和”（传输的余数）进行比较。</p>
<p>例如，有两个字节的消息原文（6，23），校验寄存器一个字节宽，除数为1001，其结果如下所示：</p>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"23",attr:["0001-0111","0x17"],type:6},
        {bits:8,name:"6",attr:["0000-0110","0x06"],type:6}
    ],config:{label:{left:"Msg"}}
}</script>
<script type="WaveDrom">{
    reg:[
        {bits:8,name:"2",attr:["0000-0010","0x02"],type:1},
        {bits:8,name:"23",attr:["0001-0111","0x17"],type:6},
        {bits:8,name:"6",attr:["0000-0110","0x06"],type:6}
    ],config:{label:{left:"Tran"}}
}</script>
<p><span class="math display">\[
\require{enclose}
\begin{array}{r}
                000\underline{0}000\underline{0}101\underline{0}110\underline{1}\, \\[-3pt]
9= 1001 \enclose{longdiv}{000\underline{0}011\underline{0}000\underline{1}011\underline{1}} \\[-3pt]
    \underline{\underline{1001}0000000}\, \\[-3pt]
    110010111\, \\
    \underline{\underline{1001}00000}\, \\
    1110111\, \\
    \underline{\underline{1001}000}\, \\
    101111\, \\
    \underline{\underline{1001}00}\, \\
    1011\, \\
    \underline{\underline{1001}}\, \\
    10\,
\end{array}\\
\]</span></p>
<p>虽然输入消息的每个位对商的影响并不那么显著，但在计算过程中，4位余数会被影响得很厉害，如果向消息中添加更多字节（被除数），它的值可能会很快再次发生根本性变化。这就是为什么除法在加法不起作用的地方起作用。</p>
<h1 id="多项式运算">多项式运算</h1>
<p>虽然前一节中描述的除法方案与称为CRC方案的校验和方案非常相似，但CRC方案实际上有点奇怪，我们需要深入研究一些奇怪的数字系统来理解它们。</p>
<h2 id="多项式环">多项式环</h2>
<p>我们知道，函数是一种映射，特指 “值域是数字集合” 的映射。这里的 “数字集合”，通常指任何一个环，换句话说，只要是个环，其元素都可以被视为 “数字”。我们熟悉的整数环、有理数域2、实数域、复数域等都是很好的例子。</p>
<p>多项式就是一种极为重要的函数。在微积分中，性质良好的函数（解析函数）都可以被表示为一列多项式函数的极限，或者说总可以用一个多项式函数来逼近它。而多项式的性质较为简单，求导也很容易。我们现在讨论的是代数，所以就不关心可以怎么用求导啊积分啊等手段去处理多项式函数，而是关心这个概念可以怎么在代数上拓展。</p>
<p>先来观察一下我们熟知的多项式吧。作为实变量函数，一个多项式<span class="math inline">\(f(x)\)</span>可以表示为：</p>
<p><span class="math display">\[
\begin{equation}
f(x) = \sum_{i=0}^N a_i x^i~,
\end{equation}
\]</span></p>
<p>其中各<span class="math inline">\(a_i\)</span>都是实数，而 xi是用来抽象表示 “任意自变量” 的。我们可以给<span class="math inline">\(x\)</span>赋值，比如取一个实数<span class="math inline">\(c\)</span>，然后令<span class="math inline">\(x=c\)</span>，这样就能得到一个<strong>实数</strong><span class="math inline">\(f(c)=\sum_{i=0}^N a_i c^i\)</span>。但要是不赋值，那<span class="math inline">\(f(x)\)</span>就不是一个具体的数，而是一个映射；<span class="math inline">\(x\)</span>只是一个抽象符号。</p>
<p>两个多项式之间根本的不同，体现在哪里呢？是抽象符号吗？显然不是。<span class="math inline">\(x^2+1\)</span>和<span class="math inline">\(y^2+1\)</span>完全可以视为同一个多项式，用的符号不同而已。决定两个多项式差异的，是多项式的<strong>系数</strong>，对吧？<span class="math inline">\(x^2+1\)</span>和<span class="math inline">\(x^2+3\)</span>就不是同一个多项式。很明显，我们应该拓展的是系数的概念。</p>
<div class="admonition admonition-success">
<p class="admonition-title">定义
</p>
<p>设<span class="math inline">\(R\)</span>是一个环,<span class="math inline">\(x\)</span>是一个抽象符号。则形如:</p>
<p><span class="math display">\[
\begin{equation}
f(x) = \sum_{i=0}^N a_i x^i~
\end{equation}
\]</span></p>
<p>的表达式称为环<span class="math inline">\(R\)</span>上的（一元）<strong>多项式（polynomial）</strong>，其中各<span class="math inline">\(a_i\in R\)</span>，称为该多项式的<strong>系数（coefficient）</strong>。<span class="math inline">\(a_i x^i\)</span>称为<span class="math inline">\(f(x)\)</span>的<span class="math inline">\(i\)</span>次<strong>项（item）</strong>，或者一个单项式，<span class="math inline">\(i\)</span>称为其<strong>次数（degree）</strong>。全体以<span class="math inline">\(x\)</span>为抽象符号的一元多项式构成的集合，记为<span class="math inline">\(R[x]\)</span>。<span class="math inline">\(R\)</span>称为<span class="math inline">\(R[x]\)</span>的<strong>系数环</strong>；如果<span class="math inline">\(R\)</span>是个域，也称之为<strong>系数域</strong>。</p>
<p>类似地，设各<span class="math inline">\(x_k\)</span>都是抽象符号，那么形如</p>
<p><span class="math display">\[
\begin{equation}
f(x_1, x_2, \cdots, x_m) = \sum_{k_1+k_2+\cdots k_m=0}^N a_{k_1, k_2, \cdots, k_m} x_1^{k_1}x_2^{k_2}\cdots x_m^{k_m}~
\end{equation}
\]</span></p>
<p>的表达式称为环<span class="math inline">\(R\)</span>上的<span class="math inline">\(m\)</span> <strong>元多项式（polynomial）</strong>，其中各<span class="math inline">\(a_{k_1, k_2, \cdots, k_m}\in R\)</span>，称为其系数。每个<span class="math inline">\(a_{k_1, k_2, \cdots, k_m} x_1^{k_1}x_2^{k_2}\cdots x_m^{k_m}\)</span>是该多项式的一个<span class="math inline">\(k_1+k_2+\cdots k_m\)</span>次项。</p>
<p>多项式中最高次的单项式的次数，称为该多项式的<strong>次数（degree）</strong>。特别的例外是，<span class="math inline">\(\operatorname {deg}0 = -\infty\)</span>。多项式<span class="math inline">\(f⁡(x)\)</span>的次数记为<span class="math inline">\(\operatorname {deg} f(x)\)</span>。在不至于混淆的情况下，也可以简单地用<span class="math inline">\(f\)</span>来表示多项式<span class="math inline">\(f⁡(x)\)</span>或<span class="math inline">\(f(x_1, x_2, \cdots, x_m)\)</span>。</p>
</div>
<div class="admonition admonition-success">
<p class="admonition-title">定义
</p>
<p>设<span class="math inline">\(g(x_1, x_2, \cdots, x_m)\in R[x_1, x_2, \cdots, x_m]\)</span>。<br>
如果<span class="math inline">\(r\in R\)</span>满足<span class="math inline">\(f(r)=0\)</span>，则称<span class="math inline">\(r\)</span>是<span class="math inline">\(f\)</span>的一个<strong>根（root）</strong>。如果数组<span class="math inline">\(\{r_1, r_2, \cdots, r_m\}\)</span>满足<span class="math inline">\(g(r_1, r_2, \cdots, r_m)\)</span>，则称该数组是<span class="math inline">\(g\)</span>的一个根。</p>
</div>
<p>举几个例子。<span class="math inline">\(x^2y+xy+y^3+2y\)</span>是一个整数环上的二元三次多项式，其中<span class="math inline">\(x^2y\)</span>和<span class="math inline">\(y^3\)</span>是其<span class="math inline">\(3\)</span>次项。我们常会用到 “多项式环” 这一术语，这是因为环上的全体多项式构成的集合<span class="math inline">\(R[x]\)</span>，还真就是一个环。</p>
<div class="admonition admonition-attention">
<p class="admonition-title">Attention</p>
<p><span class="math inline">\(R[x]\)</span>上加法和乘法的定义：同类单项式（即仅系数不同的单项式）之间的加法定义为以其系数相加的结果为系数的同类单项式，乘法类似地定义为系数的乘法；多项式乘法由单项式加法、乘法以及乘法对加法的分配律定义。</p>
</div>
<p>上面说了那么多，我一直在强调<span class="math inline">\(x\)</span>是“抽象符号”。作为实变量函数的多项式，可以把抽象符号替换为实数来赋值，一般的环上当然也可以这么做。设<span class="math inline">\(f\)</span>是环<span class="math inline">\(R\)</span>上的一元多项式，那任取一个<span class="math inline">\(r \in R\)</span>，依然有<span class="math inline">\(f(r) \in R\)</span>。</p>
<h2 id="域上的多项式除法">域上的多项式除法</h2>
<p>设<span class="math inline">\(f(x)\)</span>是一个多项式，那么使得<span class="math inline">\(f(r)=0\)</span>的<span class="math inline">\(r\)</span>就被称为这个多项式的<strong>根（root）</strong>。根的性质决定了多项式的性质。为了理解这一点，我们要先讨论一下多项式之间的除法。不过要注意的是，我们这里要讨论的是域上的多项式除法，也就是系数选自域中，而不只是一个环中。尽管如此，多项式构成的集合依然只是一个环。</p>
<p>由于环没有要求乘法逆元存在性，故除法并不总是可行的。比如<span class="math inline">\(5 \div 2\)</span>的结果就不在整数环中，尽管<span class="math inline">\(5\)</span>和<span class="math inline">\(2\)</span>都是整数。但是也正因为这样，环上诞生了独特的 “带余除法”，对，就是小学学过的<span class="math inline">\(5/2=2\cdots 1\)</span>。但是<span class="math inline">\(a/b=c\cdots r\)</span>的表述方法挺累赘的，不如写成<span class="math inline">\(a=bc+r\)</span>好了，<span class="math inline">\(a\)</span>是被除数，<span class="math inline">\(b\)</span>是除数，<span class="math inline">\(c\)</span>是商，<span class="math inline">\(r\)</span>是余数。</p>
<p>尽管上述讨论中的<span class="math inline">\(a, b, c, r\)</span>都是整数，我们也可以把这个概念移植到一般的环上。在稍后我们会讨论的 “欧几里得环” 中，这种带余除法非常重要，但现在我们就着眼于多项式环即可。</p>
<p>虑环<span class="math inline">\(R\)</span>上的多项式<span class="math inline">\(f(x)\)</span>和<span class="math inline">\(g(x)\)</span>，则总存在<span class="math inline">\(h(x)\)</span>和<span class="math inline">\(r(x)\)</span>，其中<span class="math inline">\(\operatorname {deg}r\leq \operatorname {deg}g\)</span>，使得<span class="math inline">\(f(x)=h(x)g(x)+r(x)\)</span>。这就是多项式之间的除法。如果遇到<span class="math inline">\(r(x)=0\)</span>的情况，那么就说<span class="math inline">\(g\)</span>整除<span class="math inline">\(f\)</span>，记为<span class="math inline">\(g|f\)</span> 。</p>
<div class="admonition admonition-abstract">
<p class="admonition-title">定理1<span id="定理一"></span>
</p>
<p>给定域<span class="math inline">\(\mathbb{F}\)</span>上的一个多项式<span class="math inline">\(f(x)\)</span>。如果<span class="math inline">\(r \in R\)</span>是<span class="math inline">\(f\)</span>的一个根，那么<span class="math inline">\((x-r)|f\)</span>。</p>
<div class="admonition admonition-note">
<p class="admonition-title">证明
</p>
<p>存在<span class="math inline">\(h(x), s(x)\in\mathbb{F}[x]\)</span>，使得<span class="math inline">\(f(x)=h(x)\cdot(x-r)+s(x)\)</span>，且<span class="math inline">\(s(x)\)</span>的次数小于<span class="math inline">\(1\)</span>。这样一来，<span class="math inline">\(s\)</span>实际上就是<span class="math inline">\(\mathbb{F}\)</span>的一个元素。将<span class="math inline">\(r\)</span>代入<span class="math inline">\(x\)</span>，得到<span class="math inline">\(0=f(r)=h(r)\cdot(r-r)+s\)</span>，因此<span class="math inline">\(s=0\)</span>。故得证。</p>
</div>
</div>
<p>如果环<span class="math inline">\(R\)</span>上的多项式<span class="math inline">\(f⁡(x)\)</span>可以表示为两个多项式的乘积<span class="math inline">\(h(x)g(x)\)</span>，或者说它可以被另一个次数为正的多项式整除，那么我们就说这个多项式是<strong>可约（reducible）</strong>的，而<span class="math inline">\(h\)</span> 和<span class="math inline">\(g\)</span>就被称为其<strong>因子</strong>；否则，称<span class="math inline">\(f\)</span>是<strong>不可约（irreducible）</strong>的。这样，我们只需要研究好其因子的性质，就能方便地推知<span class="math inline">\(f\)</span>本身的性质。又由于<a href="#定理一">定理1</a>，多项式的性质归根到底由根来决定——如果根存在的话。</p>
<p>现在，我们引入一个实际计算多项式除法的方法，称为长除法，用表格表示。为方便理解，我们直接用一个具体实例来讲解：在整数环上，用<span class="math inline">\(2x^2+1\)</span>去除<span class="math inline">\(6x^5+x^4+2x^3-x^2-2\)</span>。</p>
<p>第一步，是比较两个多项式的最高次项，即<span class="math inline">\(2⁢x^2\)</span>和<span class="math inline">\(6⁢x^5\)</span>，然后凑一个<span class="math inline">\(3⁢x^3\)</span>，比较<span class="math inline">\((2x^2+1)\cdot(3x^3)\)</span>和<span class="math inline">\(6x^5+x^4+2x^3-x^2-2\)</span>的差，得到<span class="math inline">\(x^4-x^3-x^2-2\)</span>。整个过程表示如下：</p>
<table>
<caption>表1</caption>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><span class="math inline">\(3⁢x^3\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(2x^2+1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(6x^5+x^4+2x^3-x^2-2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(x^4-x^3-x^2-2\)</span></td>
</tr>
</tbody>
</table>
<p>然后，再考虑剩下的<span class="math inline">\(x^4-x^3-x^2-2\)</span>被<span class="math inline">\(2x^2+1\)</span>除：</p>
<table>
<caption>表2</caption>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><span class="math inline">\(3x^3+0.5x^2\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(2x^2+1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(6x^5+x^4+2x^3-x^2-2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(x^4-x^3-x^2-2\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(-x^3-1.5x^2-2\)</span></td>
</tr>
</tbody>
</table>
<p>以此类推，最终使被除多项式的次数小于<span class="math inline">\(2x^2+1\)</span>的次数：</p>
<table>
<caption>表3<span id="表3"></span></caption>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;"><span class="math inline">\(3x^3+0.5x^2-0.5x-0.75\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(2x^2+1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(6x^5+x^4+2x^3-x^2-2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(x^4-x^3-x^2-2\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(-x^3-1.5x^2-2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(-1.5x^2+0.5x-2\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(0.5x-1.25\)</span></td>
</tr>
</tbody>
</table>
<p>于是我们就得到了:</p>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}
&amp;6x^5+x^4+2x^3-x^2-2 \\
= &amp;(3x^3+0.5x^2-0.5x-0.75)(2x^2+1)+(0.5x-1.25)~.
\end{aligned}
\end{equation}
\]</span></p>
<p>我们所求的有效信息在<a href="#表3">表 3</a>的最上方和最下方，即 “商数” 和 “余数”，而第二行则是已知的信息。剩下的部分全都是中间计算过程，算完以后就不用再关心了。</p>
<p>从运算过程你也可以看出来，为什么我们之前要求讨论范围是 “域” 上的多项式。除法的概念是可以局限在 “环” 上的多项式来讨论的，也依然可以使用长除法来计算，但就没法用到<span class="math inline">\(0.5\)</span>这样的元素，也就无法保证余的次数比除数要小了。</p>
<h2 id="素域prime-field">素域（Prime field）</h2>
<p>有限域也叫伽罗瓦域（galois field），指的是由有限个元素组成的集合，在这个集合内可以执行加、减、乘和逆运算。</p>
<ul>
<li>域中包含元素的个数称为<strong>域的阶</strong>。</li>
<li>只有当<span class="math inline">\(m\)</span>是一个素数幂时，即<span class="math inline">\(m=p^n\)</span>(其中<span class="math inline">\(n\)</span>为正整数是<span class="math inline">\(p\)</span>的次数，<span class="math inline">\(p\)</span>为素数)，阶为<span class="math inline">\(m\)</span>的域才存在，<span class="math inline">\(p\)</span>称为这个<strong>域的特征</strong>。</li>
</ul>
<p>也就是说，有限域中元素的个数可以是11(<span class="math inline">\(p\)</span>=11是一个素数,<span class="math inline">\(n\)</span>=1)、可以是81(<span class="math inline">\(p\)</span>=3是一个素数，<span class="math inline">\(n\)</span>=4)、也可以是256(<span class="math inline">\(p\)</span>=2是一个素数，<span class="math inline">\(n\)</span>=8).....但有限域的中不可能拥有12个元素，因为<span class="math inline">\(12=2·2·3\)</span>，因此12也不是一个素数幂。</p>
<p>有限域中最直观的例子就是阶为素数的域，即<span class="math inline">\(m=pn,(n=1)\)</span>的域，域中的元素可以用整数<span class="math inline">\(\{0、1、...、p−1\}\)</span>来表示。</p>
<p>域的两种操作就是<strong>整数加法（模<span class="math inline">\(p\)</span>）</strong>和<strong>整数乘法（模<span class="math inline">\(p\)</span>）</strong>，<span class="math inline">\(p\)</span>是一个素数，整数环Z表示为<span class="math inline">\(GF(p)\)</span>，也成为拥<strong>有素数个元素的素数域</strong>或者<strong>伽罗瓦域</strong>。</p>
<div class="admonition admonition-note">
<p class="admonition-title">总结
</p>
<p>素域就是有素数个元素的有限域，即阶为素数的有限域。</p>
</div>
<ul>
<li><span class="math inline">\(GF(p)\)</span>中所有的非零元素都存在逆元</li>
<li><span class="math inline">\(GF(p)\)</span>内所有的运算都是模<span class="math inline">\(p\)</span>实现的。</li>
</ul>
<p>素域内的算数运算规则如下：</p>
<ul>
<li>加法和乘法都是通过模<span class="math inline">\(p\)</span>实现的；</li>
<li>任何一个元素<span class="math inline">\(a\)</span>的加法逆元都是由<span class="math inline">\(a+\)</span>(<span class="math inline">\(a\)</span>的逆元)=<span class="math inline">\(0\)</span>(mod <span class="math inline">\(p\)</span>)得到的；</li>
<li>任何一个非零元素<span class="math inline">\(a\)</span>的乘法逆元定义为<span class="math inline">\(a·\)</span>(<span class="math inline">\(a\)</span>的逆元)=<span class="math inline">\(1\)</span>(mod <span class="math inline">\(p\)</span>)。</li>
</ul>
<p>例：在素域<span class="math inline">\(GF(5)=\{0,1,2,3,4\}\)</span>中，<span class="math inline">\(2\)</span>的加法逆元为<span class="math inline">\(3\)</span>，这是因为，<span class="math inline">\(2+(3)=5\)</span>，<span class="math inline">\(5 \mod 5=0\)</span>,所以<span class="math inline">\(2+3=5 \mod 5=0\)</span>；<span class="math inline">\(2\)</span>的乘法逆元为<span class="math inline">\(3\)</span>，这是因为，<span class="math inline">\(2·3=6\)</span>，<span class="math inline">\(6 \mod 5=1\)</span>，所以<span class="math inline">\(2·3=6 \mod 5=1\)</span>。</p>
<div class="admonition admonition-note">
<p class="admonition-title">Note</p>
<p>在很多地方<span class="math inline">\(a\)</span>的加法逆元用<span class="math inline">\(-a\)</span>表示，<span class="math inline">\(a\)</span>的乘法逆元用<span class="math inline">\(a^{-1}\)</span>表示</p>
</div>
<p>注：<span class="math inline">\(GF(2)\)</span>是一个非常重要的素域，也是存在的最小的有限域，由于<span class="math inline">\(GF(2)\)</span>的加法，即模<span class="math inline">\(2\)</span>加法与<strong>异或(XOR)门</strong>等价，<span class="math inline">\(GF(2)\)</span>的乘法与<strong>逻辑与(AND)门</strong>等价。<br>
加法：<span class="math inline">\(0+1=1;1+1=0;0+0=0\)</span><br>
乘法：<span class="math inline">\(1\times 0 = 0;1 \times 1 =1; 0 \times 0 = 0\)</span></p>
<p>另外素域<span class="math inline">\(GF(p)\)</span>一般还用符号<span class="math inline">\(F_p\)</span>表示，记<span class="math inline">\(F_p^*\)</span>是由<span class="math inline">\(F_p\)</span>中所有非零元构成的乘法群，即<span class="math inline">\((1,2,\dots,p-1)\)</span>，又因为<span class="math inline">\(F_p^*\)</span>是循环群，所以在<span class="math inline">\(F_p\)</span>中至少存在一个元素<span class="math inline">\(g\)</span>，使得<span class="math inline">\(F_p\)</span>中任意非零元都可以由<span class="math inline">\(g\)</span>的一个幂表示，称<span class="math inline">\(g\)</span>为<span class="math inline">\(F_p^*\)</span>的生成元（本原元），即<span class="math inline">\(F_p^*=\{g^i|0\leq i \leq p-2\}\)</span>。设<span class="math inline">\(a=g^i \in F_p^*\)</span>，其中<span class="math inline">\(0 \leq i \leq p-2\)</span>。则<span class="math inline">\(a\)</span>的乘法逆元<span class="math inline">\(a^{-1}=g^{p-1-i}\)</span>。</p>
<p>举例：<br>
<span class="math inline">\(13\)</span>是<span class="math inline">\(F_{19}^∗\)</span>的一个生成元，则<span class="math inline">\(F_{19}^∗\)</span>中的元素可以由13的方幂表示出来：<br>
<span class="math inline">\(13^0=1,13^1=13,13^2=17,13^3=12,13^4=4,13^5=14,13^6=11,13^7=10,13^8=16,13^9=18,\)</span><br>
<span class="math inline">\(13^{10}=6,13^{11}=2,13^{12}=7,13^{13}=15,13^{14}=5,13^{15}=8,13^{16}=9,13^{17}=3,13^{18}=1\)</span></p>
<h2 id="扩域extension-field">扩域（extension field）</h2>
<p>如果有限域的阶不是素数，则这样的有限域内的加法和乘法运算就不能用整数加法模<span class="math inline">\(p\)</span>和整数乘法模<span class="math inline">\(p\)</span>表示。</p>
<div class="admonition admonition-note">
<p class="admonition-title">Note</p>
<p>阶数不是素数，且大于1的有限域被称为扩展域</p>
</div>
<p>为了处理扩展域，我们就要使用不同的符号表示扩展域内的元素，使用不同的规则执行扩展域内元素的算术运算。</p>
<p>设<span class="math inline">\(q\)</span>是一个素数或素数方幂，<span class="math inline">\(f(x)\)</span>是多项式环<span class="math inline">\(F_q[x]\)</span>上的一个<span class="math inline">\(m(m&gt;1)\)</span>次<strong>不可约多项式</strong>，<strong>商环</strong><span class="math inline">\(F_q[x]/f(x)\)</span>是含<span class="math inline">\(q^m\)</span>个元素的有限域，记<span class="math inline">\(F_{q^m}\)</span>，即<span class="math inline">\(F_{q^m}\)</span>是有限域<span class="math inline">\(F_q\)</span>的扩域，域<span class="math inline">\(F_q\)</span>是域<span class="math inline">\(F_{q^m}\)</span>的子域，<span class="math inline">\(m\)</span>是扩展次数（因子）。</p>
<p><span class="math inline">\(F_{q^m}\)</span>可以看作<span class="math inline">\(F_q\)</span>上的<span class="math inline">\(m\)</span>维向量空间，即在<span class="math inline">\(F_{q^m}\)</span>中存在<span class="math inline">\(m\)</span>个元素<span class="math inline">\(\left \{ \alpha_{0},\alpha_{1},...., a_{m-1} \right \}\)</span>，使得<span class="math inline">\(\forall a \in F_{q^{m}}\)</span>，<span class="math inline">\(a\)</span>可以唯一表示为：<span class="math inline">\(a=a_{m-1}\alpha_{m-1}+...+a_{1}\alpha_{1}\)</span>，其中<span class="math inline">\(a_i\in F_q\)</span>，把<span class="math inline">\(\left\{\alpha_{m-1}, \cdots, \alpha_{1}, \alpha_{0}\right\}\)</span>叫做<span class="math inline">\(F_{q^m}\)</span>上在<span class="math inline">\(F_q\)</span>上的一组基。</p>
<p>给定这样的一组基，就可以由向量<span class="math inline">\(\left(a_{m-1},a_{m-2}...., a_{1}, a_{0}\right)\)</span>来表示域元素<span class="math inline">\(a\)</span>。</p>
<p><span class="math inline">\(F_{q^m}\)</span>在<span class="math inline">\(F_q\)</span>上的基有多种选择：多项式基和正规基等，下面简单介绍：</p>
<div class="admonition admonition-success">
<p class="admonition-title">多项式基
</p>
<p>不可约多项式<span class="math inline">\(f(x)\)</span>可以取首一多项式<span class="math inline">\(f(x)=x^{m}+f x^{m-1}+...+f_{2} x^{2}+f_{1} x+f_{0}\)</span>（其中<span class="math inline">\(f_i\in F_q,i=0,...,m-1\)</span>）</p>
<p><span class="math inline">\(F_{q^m}\)</span>中的元素由多项式环<span class="math inline">\(F_q[x]\)</span>中所有次数低于<span class="math inline">\(m\)</span>的多项式构成，即<span class="math inline">\(F_{q^m}=\left\{a_{m-1} x^{m-1}+a_{m-2} x^{m-2}+\cdots+a_{1} x+a_{0} \mid a_{i} \in F_{q}, i=0,1, \cdots, m-1\right\}\)</span></p>
<p>多项式集合<span class="math inline">\(\left\{x^{m-1}, x^{m-2}, \cdots, x, 1\right\}\)</span>是 <span class="math inline">\(F_{q^m}\)</span>作为向量空间在<span class="math inline">\(F_q\)</span>上的一组基，称为多项式基</p>
<p>当<span class="math inline">\(m\)</span>含有因子<span class="math inline">\(d(1&lt;d&lt;m)\)</span>时, <span class="math inline">\(F_{q^m}\)</span>可以由<span class="math inline">\(F_{q^d}\)</span>扩张生成, 从<span class="math inline">\(F_{q^d}[x]\)</span>中选取一个合适的<span class="math inline">\(m/d\)</span>次不可约多项式作为<span class="math inline">\(F_{q^m}\)</span>在<span class="math inline">\(F_{q^d}\)</span>上的不可约多项式，<span class="math inline">\(F_{q^m}\)</span>可以由<strong>塔式扩张方法 (towering method)</strong> 得到, 这种扩张的基本形式仍是由<span class="math inline">\(F_q\)</span>中元素组成的向量</p>
<p>例如当<span class="math inline">\(m=6\)</span>时, 可以先由<span class="math inline">\(F_q\)</span>经过<span class="math inline">\(3\)</span>次扩张得扩域<span class="math inline">\(F_{q^3}\)</span> ，再由<span class="math inline">\(F_{q^3}\)</span>经过<span class="math inline">\(2\)</span>次扩张得到扩域<span class="math inline">\(F_{q^6}\)</span> ; 也可以先由<span class="math inline">\(F_q\)</span>经过<span class="math inline">\(2\)</span>次扩张得扩域<span class="math inline">\(F_{q^2}\)</span>, 再由<span class="math inline">\(F_{q^2}\)</span>经过<span class="math inline">\(3\)</span>次扩张得到扩域<span class="math inline">\(F_{q^6}\)</span></p>
</div>
<div class="admonition admonition-success">
<p class="admonition-title">正规基
</p>
<p><span class="math inline">\(F_{q^m}\)</span>在<span class="math inline">\(F_q\)</span>上形如<span class="math inline">\(\left\{\beta, \beta^{q}, \beta^{q^{2}}, \cdots, \beta^{q^{m-1}}\right\}\)</span>的一组基称为<strong>正规基</strong>, 其中<span class="math inline">\(\beta \in F_{q^{m}}\)</span> 。 <span class="math inline">\(\forall a \in F_{q^{m}}, a\)</span>可以唯一表示为:<span class="math inline">\(a=a_{0} \beta+a_{1} \beta^{q}+\cdots+a_{m-1} \beta^{q^{m-1}}\)</span>, 其中<span class="math inline">\(a_{i} \in F_{q}, i=0,1, \cdots, m-1\)</span>。</p>
<p>对于任意有限域<span class="math inline">\(F_q\)</span>及其扩域<span class="math inline">\(F_{q^m}\)</span>, 这样的基总是存在的。</p>
</div>
<p>例如在扩展域<span class="math inline">\(GF(2^m)\)</span>中，元素并不是用整数表示的，而是用系数为域GF(2)中元素的多项式表示，这个多项式最大<strong>阶数（degree）</strong>为<span class="math inline">\(m-1\)</span>，所以每个元素共有<span class="math inline">\(m\)</span>个系数。比如在AES算法使用的域<span class="math inline">\(GF(2^8)\)</span>中，每个元素<span class="math inline">\(A\in GF(2^8)\)</span>都可以表示为：<span class="math inline">\(A(x)=a_7x^7+a_6x^6+...+a_1x+a_0,a_i\in GF(2)\)</span></p>
<p>注意：在域<span class="math inline">\(GF(2^8)\)</span>中这样的多项式共有<span class="math inline">\(256\)</span>个，这<span class="math inline">\(256\)</span>个多项式组成的集合就是<strong>扩展域</strong><span class="math inline">\(GF(28)\)</span>，每个多项式都可以按一个<span class="math inline">\(8\)</span>位向量的数值形式存储：<span class="math inline">\(A=(a_7,a_6,...,a_1,a_0)\)</span>，像<span class="math inline">\(x^7,x^6,…x\)</span>等因子都无需存储，因为从位的位置就可以清楚地判断出每个系数对应的幂。</p>
<p>扩域<span class="math inline">\(GF(2^m)\)</span>内的算数运算规则如下：</p>
<div class="admonition admonition-success">
<p class="admonition-title">加减法
</p>
<p>在AES算法中的密钥加法层中就使用了这部分的知识，但是不是很明显，因为我们通常把扩展域中的加法当作异或运算进行处理了，因为<strong>在扩展域</strong><span class="math inline">\(GF(2^m)\)</span>中的加减法处理都是在底层域<span class="math inline">\(GF(2)\)</span>内完成的，与按位异或运算等价。假设<span class="math inline">\(A(x)、B(x)∈GF(2^m)\)</span>。</p>
<p>计算两个元素之和的方法就是：<span class="math inline">\(C(x)=A(x)+B(x)=\sum_{i=0}^{m-1}c_ix^i\)</span>,其中<span class="math inline">\(c_i=(a_i+b_i)mod 2\)</span></p>
<p>两个元素之差的计算公式就是：<span class="math inline">\(C(x)=A(x)-B(x)=\sum_{i=0}^{m-1}C_ix^i\)</span>,其中<span class="math inline">\(c_i=(a_i-b_i)mod 2=(a_i+b_i)mod 2\)</span></p>
<p><strong>注：</strong>在减法运算中减号之所以变成加号，这就和二进制减法的性质有关了，从上述两个公式中我们发现<strong>在扩展域中加法和减法等价，并且与XOR等价(异或运算也被称作二进制加法)</strong>。</p>
</div>
<div class="admonition admonition-success">
<p class="admonition-title">乘法
</p>
<p>扩展域的乘法主要运用在AES算法的列混淆层(Mix Column)中，也是列混淆层中最重要的操作。</p>
<p>我们想将扩展域中的两个元素用多项式形式展开，然后使用标准的多项式乘法规则将两个多项式相乘：<span class="math inline">\(C(x)=A(x).B(x)=(a_{m-1}x^{m-1}+...+a_0).(b_{m-1}x^{m-1}+...+b_0)=c_{2m-2}x^{2m-2}+...+c_0\)</span>，其中<span class="math inline">\(c_0=(a_0.b_0)mod 2,c_1=(a_1.b_0+a_0.b_1)mod 2,...,c_{2m-2}=(a_{m-1}.b_{m-1})mod 2\)</span></p>
<p><strong>注：</strong>通常在多项式乘法中<span class="math inline">\(C(x)\)</span>的级数会大于<span class="math inline">\(m−1\)</span>，因此需要对此进行化简，而化简的基本思想与素域内乘法情况相似：在素域<span class="math inline">\(GF(p)\)</span>中，将两个整数相乘得到的结果除以一个素数，化简后的结果就是最后的余数。而在扩展域中进行的操作就是：<strong>将两个多项式相乘的结果除以一个不可约多项式</strong>，最后的结果就是最后的<strong>余数</strong>。(这里的不可约多项式大致可以看作一个素数)</p>
<p><img src="/2024/07/31/CRC%E6%A0%A1%E9%AA%8C%E8%AF%A6%E8%A7%A3/1016082-20191013181934067-1708066142.png" alt="GF(2^m)乘法"></p>
</div>
<p>举例：<br>
<img src="/2024/07/31/CRC%E6%A0%A1%E9%AA%8C%E8%AF%A6%E8%A7%A3/1016082-20191013181956923-556582755.png"></p>
<h2 id="crc多项式运算">CRC多项式运算</h2>
<p>在处理CRC算法时，你经常听到的单词是“多项式”。给定的CRC算法将被称为使用特定的多项式，而CRC算法通常被称为是使用多项式算法进行操作的，即数字10111对应于多项式<span class="math inline">\(x^4+x^2+x+1\)</span>,而多项式之间的加法和减法都是异或运算（因为CRC多项式的系数属于GF(2),GF(2)加减法就是异或运算）——指数相同的项的系数进行异或。<br>
而乘法运算则是在原有基础之上，还满足分配律。例如：</p>
<p><span class="math display">\[
\begin{align*}
(x^3+x^2+x^0)(x^3+x^1+x^0)=&amp;x^6+x^4+x^3 \\+&amp;x^5+x^3+x^2 \\ +&amp;x^3+x^1+x^0 \\= &amp;x^6+x^5+x^4+x^3+x^2+x^1+x^0
\end{align*}
\]</span></p>
<h1 id="没有进位信号的二进制运算">没有进位信号的二进制运算</h1>
<p>在省略了多项式之后，我们可以专注于真正的算术问题，即CRC计算期间执行的所有算术都是在二进制中执行的，没有进位。这通常被称为多项式算术，但正如我在本文档的其余部分所声明的那样，我们必须称之为CRC算术。由于这个算法是CRC计算的关键部分，我们最好习惯它。</p>
<p>CRC算术中的两个数字相加与普通二进制算术中的数字相加相同，除了没有进位。这意味着每对对应的比特确定对应的输出比特，而不参考任何其他比特位置。例如：</p>
<p><span class="math display">\[
\begin{align*}
    &amp;10011011 \\+ &amp;11001010 \\= &amp;01010001 \\
    \\ \\
    &amp;10011011 \\- &amp;11001010 \\= &amp;01010001
\end{align*}
\]</span></p>
<p>定义了加减法之后，就可以很容易地定义<strong>乘除法</strong>。例如乘法就与普通的二进制乘法类似，除了最后求和的时候，使用的是忽略进位的加法。而除法也与普通的二进制除法类似（不考虑借位，而且大小的判断也与二进制不一样，如果<span class="math inline">\(X\)</span>最高位的1的位置大于或者等于<span class="math inline">\(Y\)</span>最高位1的位置，则<span class="math inline">\(X\)</span>大于等于<span class="math inline">\(Y\)</span>）。</p>
<p>乘法示例：</p>
<p><span class="math display">\[
\begin{align*}
            1101    \\
    \times  1011    \\
            ---     \\
            1101    \\
            11010   \\
            000000  \\
            1101000 \\
            ----    \\
            1111111
\end{align*}
\]</span></p>
<p>除法示例：</p>
<p><span class="math display">\[
\require{enclose}
\begin{array}{r}
                1100001010\, \\[-3pt]
 10011 \enclose{longdiv}{11010110110000} \\[-3pt]
    10011\phantom{110110000\,} \\
    --------    \\
    1001110110000\,     \\
    10011\phantom{10110000\,} \\
    -------     \\
    10110000\,  \\
    10011\phantom{000\,} \\
    ----- \\
    101000\, \\
    10011\phantom{0\,}\\
    ----\\
    1110
\end{array}\\
\]</span></p>
<p>定义了乘除之后，就可以定义倍数和整除的概念了（其实就是除法的余数等于0）。但是根据其乘法的性质，还可以得到如下的推论。</p>
<div class="admonition admonition-note">
<p class="admonition-title">倍数的推论
</p>
<p>如果<span class="math inline">\(A\)</span>是<span class="math inline">\(B\)</span>的倍数，则意味着，<span class="math inline">\(A\)</span>可以由<span class="math inline">\(B\)</span>的不同移位的结果相加得到。</p>
<div class="admonition admonition-example">
<p class="admonition-title">Example</p>
<p><span class="math inline">\(A=0111010110\)</span>，<span class="math inline">\(B=11\)</span>，则<span class="math inline">\(A\)</span>可以通过如下方式从<span class="math inline">\(B\)</span>构造而来:</p>
<p><span class="math display">\[
\begin{align*}
    0111010110 \\
    =\phantom{00000000}11\phantom{0}    \\
    +\phantom{000000}11\phantom{0000}    \\
    +\phantom{00000}11\phantom{00000}    \\
    +\phantom{000}11\phantom{0000000}    \\
\end{align*}
\]</span></p>
<p>而如果<span class="math inline">\(A\)</span>是<span class="math inline">\(0111010111\)</span>，则无法通过<span class="math inline">\(B\)</span>构造而来，因此就不能被B整除。</p>
</div>
</div>
<h1 id="一个可行的示例">一个可行的示例</h1>
<p>定义了上述的运算法则之后，特别是除法运算规则之后，我们就可以得到CRC算法了。</p>
<p>要执行CRC计算，我们需要选择一个除数。在数学营销中，除数被称为“生成多项式”或简称为“多项式”，是任何CRC算法的关键参数。你可以选择任何多项式，并提出CRC算法。然而，有些多项式比其他多项式更好，所以明智的做法是坚持使用经过测试的多项式。稍后的部分将讨论这个问题。</p>
<p>多项式的宽度（最高位的1所处的位置，例如10011的宽度就是4，而不是5）是很重要的，因为它主导着整个计算，通常来说，16或者32的宽度比较常用，因为可以简化现代计算机实现。为了示例的目的，我选择多项式10011（<span class="math inline">\(W\)</span>等于4）作为演示。</p>
<p>选择好多项式之后，就可以进行CRC计算了（就是CRC除法），需要注意的是，在进行除法之前，需要在原始消息的末尾添加<span class="math inline">\(W\)</span>位的0(这么做的原因是，除法会得到<span class="math inline">\(W\)</span>位的余数<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>，而将得到的余数替换增加的<span class="math inline">\(W\)</span>位0之后，就可以被整除了)</p>
<p>例如：</p>
<blockquote>
<p>原始信息     ：1101011011<br>
多项式      ：10011<br>
补0后的信息    ：11010110110000</p>
</blockquote>
<p>至此，就可以使用CRC除法，来将补0后的信息来除以多项式。</p>
<p><span class="math display">\[
\begin{align*}
    1100001010\, &amp; = 商（没人关心这个结果）\\[-3pt]
 多项式=10011\enclose{longdiv}{11010110110000}&amp; = 补0后的消息数据\\[-3pt]
    10011\phantom{110110000\,} \\
    --------    \\
    1001110110000\,     \\
    10011\phantom{10110000\,} \\
    -------     \\
    10110000\,  \\
    10011\phantom{000\,} \\
    ----- \\
    101000\, \\
    10011\phantom{0\,}\\
    ----\\
    1110 &amp; = 余数 = 校验数据
\end{align*}
\]</span></p>
<p>因此最终用发送的消息是1101011011<strong>1110</strong></p>
<p>而在另一端的接收方需要做如下两件事情中的一件：</p>
<ol type="1">
<li>分开消息与校验信息，计算消息的校验信息（需要补<span class="math inline">\(W\)</span>位0），然后比较校验信息是否一致。</li>
<li>对收到的数据整体计算校验信息（就是除以多项式，而且不用补0），然后看得到的校验信息是否为0（余数是否等于0）</li>
</ol>
<div class="admonition admonition-abstract">
<p class="admonition-title">总结
</p>
<p>CRC算法的整个运作流程如下：<br>
1. 确定宽度<span class="math inline">\(W\)</span>和多项式<span class="math inline">\(G\)</span>(宽度为<span class="math inline">\(W\)</span>)<br>
2. 添加<span class="math inline">\(W\)</span>比特的0到消息的末尾，称之为<span class="math inline">\(M^{\prime}\)</span><br>
3. 使用CRC除法，用<span class="math inline">\(G\)</span>来除<span class="math inline">\(M^{\prime}\)</span>，余数就是校验和</p>
</div>
<h1 id="多项式的选择">多项式的选择</h1>
<p>选择多项式有点像一门黑魔法，读者可以参考[Tanenbaum81]<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>（第130-132页），其中对这个问题进行了非常清晰的讨论。本节主要针对于想要了解构建自己的多项式的人。如果你不关心为什么一个poly可能比另一个好，只是想了解高速实现，请选择本节末尾列出的算术上合理的poly之一，然后跳到下一节。</p>
<p>首先，我们可以发现，经过CRC之后，发送的数据<span class="math inline">\(T\)</span>是多项式的倍数，而如果传输途中受到了干扰，则接收方收到的数据是<span class="math inline">\(T+E\)</span>，其中<span class="math inline">\(E\)</span>是干扰向量，<span class="math inline">\(+\)</span>是CRC加法（即XOR）。当接收机收到消息<span class="math inline">\(T+E\)</span>后，则会将其除以多项式<span class="math inline">\(G\)</span>，由于<span class="math inline">\(T \mod G = 0\)</span>，因此<span class="math inline">\((T+E) \mod G = E \mod G\)</span>，因此我们所选多项式的检错能力取决于多项式<span class="math inline">\(G\)</span>的倍数集，因为只要干扰向量<span class="math inline">\(E\)</span>是多项式<span class="math inline">\(G\)</span>的倍数，错误就不会被检测出来。所以我们的任务就是去找到一类<span class="math inline">\(G\)</span>，使得它的倍数集尽可能与线路的噪声不一致。</p>
<p>我们可以假设有如下类型的线路噪声：</p>
<div class="admonition admonition-danger">
<p class="admonition-title">单比特错误
</p>
<p>单比特错误意味着<span class="math inline">\(E=1000\cdots 0000\)</span>，面对这类错误，只要确保<span class="math inline">\(G\)</span>至少有两比特1，就一定能够检测出来。因为通过对<span class="math inline">\(G\)</span>移位求和的方式，无法从多个1构建出只有一个1。</p>
</div>
<div class="admonition admonition-danger">
<p class="admonition-title">两比特错误
</p>
<p>为了检测出形如<span class="math inline">\(E=100\cdots 000100 \cdots 000\)</span>的错误（<span class="math inline">\(E\)</span>包含两比特的1），<span class="math inline">\(G\)</span>的倍数当中不能包含<span class="math inline">\(11,101,1001,10001,100001,\dots\)</span>等数字，我不知道如何构建这类<span class="math inline">\(G\)</span>，但是Tanenbaum说这类<span class="math inline">\(G\)</span>确实存在，并且他提供了一个例子——<span class="math inline">\(G=x^{15}+x^{14}+1\)</span>无法整除任何等于<span class="math inline">\(x^k+1\)</span>的数，只要<span class="math inline">\(k\)</span>小于<span class="math inline">\(32768\)</span>。</p>
</div>
<div class="admonition admonition-danger">
<p class="admonition-title">奇数位错误
</p>
<p>为了检测出奇数位错误，我们可以选择具有偶数个1的生成多项式。之所以可以这么做的原因如下：</p>
<div class="admonition admonition-tip">
<p class="admonition-title">解释
</p>
<ol type="1">
<li>CRC乘法就是将一个常数的各种移位结果进行XOR。</li>
<li>如果一个数<span class="math inline">\(G\)</span>有偶数个1，然后使用<span class="math inline">\(G\)</span>异或数<span class="math inline">\(M\)</span>，其得到的结果与<span class="math inline">\(M\)</span>中1的个数的奇偶性相同，即使用<span class="math inline">\(G\)</span>来异或一个数，不会改变数中1个数的奇偶性。</li>
</ol>
</div>
<p>大部分流行的CRC多项式都包含偶数个1（Tanenbaum说，所有奇数比特的错误都可以通过将G设为11的倍数来捕获）。</p>
</div>
<div class="admonition admonition-danger">
<p class="admonition-title">突发错误
</p>
<p>长度为<span class="math inline">\(k\)</span>的突发错误可以表示为<span class="math inline">\(E=x^i(x^{k-1}+\cdots +1)\)</span>，其中<span class="math inline">\(i\)</span>表示突发错误在接受帧中的起始位置，且假设消息中的校验位有<span class="math inline">\(r\)</span>比特（生成多项式<span class="math inline">\(G\)</span>的度为<span class="math inline">\(r\)</span>，其二进制表示的宽度为<span class="math inline">\(r+1\)</span>），依据突发错误的长度，可分为以下几种类型：</p>
<div class="admonition admonition-example">
<p class="admonition-title"> 如果 $k < r+1$
</p>
<p>当<span class="math inline">\(G\)</span>包含项<span class="math inline">\(x^0\)</span>时，<span class="math inline">\(x^i\)</span>就不是<span class="math inline">\(G\)</span>的因子（<span class="math inline">\(i=0\)</span>时，没有该项，因此就可以不考虑<span class="math inline">\(x^i\)</span>），如果此时<span class="math inline">\(x^{k-1}+\cdots +1\)</span>的度要小于<span class="math inline">\(G\)</span>的度，则<span class="math inline">\(E \mod G \neq 0\)</span>，因此错误可以被检测到。</p>
<p>所以总的来说，当<span class="math inline">\(G\)</span>包含项<span class="math inline">\(x^0\)</span>时，只要满足<span class="math inline">\(k \leq r\)</span>的突发错误，都可以被检测出来。</p>
</div>
<div class="admonition admonition-example">
<p class="admonition-title">如果 $k = r+1$
</p>
<p>当且仅当<span class="math inline">\(x^{k-1}+\cdots +1=G\)</span>时，<span class="math inline">\(E \mod G = 0\)</span>，由于其首尾两位恒为<span class="math inline">\(1\)</span>，因此是否与<span class="math inline">\(G\)</span>相等主要取决于中间的<span class="math inline">\(r-1\)</span>比特，如果假设中间的每一比特发生错误的概率都是<span class="math inline">\(1/2\)</span>，那么无法检测出错误的概率就是<span class="math inline">\((\frac{1}{2})^{r-1}\)</span>。</p>
</div>
<div class="admonition admonition-example">
<p class="admonition-title">如果 $k > r+1$ 或者 多个短的突发错误发生
</p>
<p>无法检测出错误的概率为<span class="math inline">\((\frac{1}{2})^{r}\)</span>。</p>
</div>
</div>
<table>
<caption>一些流行的多项式</caption>
<thead>
<tr class="header">
<th style="text-align: center;">校验位位数</th>
<th style="text-align: center;">多项式</th>
<th style="text-align: center;">应用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">16</td>
<td style="text-align: center;">（16,12,5,0）</td>
<td style="text-align: center;">X25 standard</td>
</tr>
<tr class="even">
<td style="text-align: center;">16</td>
<td style="text-align: center;">（16,15,2,0）</td>
<td style="text-align: center;">CRC-16</td>
</tr>
<tr class="odd">
<td style="text-align: center;">32</td>
<td style="text-align: center;">(32,26,23,22,16,12,11,10,8,7,5,4,2,1,0)</td>
<td style="text-align: center;">Ethernet</td>
</tr>
</tbody>
</table>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check#Polynomial_representations">常用CRC连接</a></p>
<h1 id="一种简单的crc实现simple">一种简单的CRC实现（SIMPLE）</h1>
<p>要实现CRC算法，我们所要做的就是实现CRC除法，而CRC除法的运算过程中，消息的比特流被馈送到除法寄存器当中，因此在下面的讨论中，消息被当作字节流（每个字节8 bits,bit 7时MSB），而字节流中数据的馈送顺序为——第一个字节的MSB(bit 7)到第一个字节的LSB(bit 0)，然后第二个字节，并且依此类推。</p>
<p>为了描述方便，这里选择多项式为<span class="math inline">\(10111\)</span>（<span class="math inline">\(W=4\)</span>）,其结构如下图所示：</p>
<img class="kroki" src="https://kroki.io/svgbob/svg/eNpTUIADYyA2AmJDIDYAYqfMkmIFLri0tq6uLgpW4ArIL1BUsNHVVagByqNioCgQKDiWpuem5pWkpijkphYXJ6an4jcQJgtyAtgNhkjYViEkI1UhID-nEgAOvCM1">
<div class="admonition admonition-note">
<p>Augmented message : the raw message followed by <span class="math inline">\(W\)</span> zero bits</p>
</div>
<p>除法流程如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">将寄存器初始化为全0</span><br><span class="line">在原始消息的后面补充W位0</span><br><span class="line">While(还有消息比特)</span><br><span class="line">    Begin</span><br><span class="line">        将寄存器中的内容左移一位，寄存器最低位补上剩余消息的首位</span><br><span class="line">        IF(上一步左移时，Pop的数据等于1)</span><br><span class="line">            Register = Register XOR Poly</span><br><span class="line">    End</span><br><span class="line">当前寄存器的值就是余数，即校验码   </span><br></pre></td></tr></table></figure>
<div class="admonition admonition-note">
<p class="admonition-title">Note</p>
<p>在实际实现中，IF当中的条件可以使用其他判据。例如，在移位之前，判断寄存器最高位是否等于1</p>
</div>
<h1 id="基于表的crc实现table-algorithm">基于表的CRC实现（TABLE ALGORITHM）</h1>
<p>上面的SIMPLE算法是一个很好的起点，因为它直接对应于到目前为止提出的理论。然而，由于它是在位级别操作的，因此编写代码（即使是在C中）也相当笨拙，执行效率也很低（它必须为每个位循环一次）。为了加快速度，我们需要找到一种方法，使算法能够以大于一位的单位处理消息。候选数量是半字节（4位）、字节（8位）、字（16位）和长字（32位），甚至更长。其中，最好避免4位，因为它不对应于字节边界。至少，任何加速都应该允许我们在字节边界上操作。事实上，大多数表驱动算法一次操作一个字节。</p>
<p>为了便于讨论，让我们从4位poly切换到32位poly。我们的寄存器看起来几乎一样，除了方框代表字节而不是位，Poly是33位（最高位是隐式的1）（<span class="math inline">\(W=32\)</span>）。</p>
<img class="kroki" src="https://kroki.io/svgbob/svg/eNpTUEAAYxBhBCIMQYQBEDtVlqQWK3DBlWjrAgE6ocAVkF-gqGCjq6tQA1KEQdiAlOkqOJam56bmlaSmKOSmFhcnpqcSNhiuwhBqiLGRQlJmSbECmKNrBwBQ3SUN">
<p>在这个框图中，SIMPLE算法仍然适用，我们可以在这个模型当中使用上面的SIMPLE算法，然后推导出基于表实现的算法。想象一下，SIMPLE算法正在全面展开，并考虑32位寄存器（字节3）的前8位的值是<span class="math inline">\(t_7,t_6,t_5,t_4,t_3,t_2,t_1,t_0\)</span></p>
<p>在SIMPLE算法的下一次迭代中，<span class="math inline">\(t_7\)</span>决定了寄存器中的值是否需要与Poly进行异或（<span class="math inline">\(t_7=1\)</span>，则需要异或），假设Poly的最高八位是<span class="math inline">\(g_7,g_6,\cdots,g_0\)</span>(剩下的32位中的最高八位)，因此迭代之后，最高字节的值为：</p>
<p><span class="math display">\[
\begin{align*}
    t_6&amp; \quad&amp; t_5&amp; \quad&amp; t_4&amp; \quad&amp; t_3&amp; \quad&amp; t_2&amp; \quad&amp; t_1&amp; \quad&amp; t_0&amp; \quad&amp; ??&amp;  \\
    + \ t_7 \ *(g_7&amp; \quad&amp; g_6&amp; \quad&amp; g_5&amp; \quad&amp; g_4&amp; \quad&amp; g_3&amp; \quad&amp; g_2&amp; \quad&amp; g_1&amp; \quad&amp; g_0&amp;)  \qquad ps:\  +=XOR
\end{align*}
\]</span></p>
<p>因此下一次迭代中的最高位为<span class="math inline">\(t_6+t_7*g_7\)</span>，因此依据递归的方法，我们可以算出前8次（亦或是16，32，可以自定，这里以8举例）迭代时，寄存器中的最高位。而依据这八个值，就可以算出这八次迭代对寄存器的影响（Poly各种移位结果进行异或）。至此我们可以发现如下特性：</p>
<ul>
<li>寄存器的最高字节已经无关紧要了，就算被移出寄存器也无妨</li>
<li>由Poly各种移位结果（8种）进行异或产生的数据<span class="math inline">\(T\)</span>长度为<span class="math inline">\(32+8\)</span>，根据长除法的运算过程可知，<span class="math inline">\(T\)</span>的高<span class="math inline">\(8\)</span>位对当前的余数不产生影响，因此只需要取其低<span class="math inline">\(32\)</span>位即可</li>
</ul>
<p>因此在经历过这8次迭代之后，剩下的余数为<span class="math inline">\(\{Register[23:0],剩余消息的最高字节\} \oplus T[32:0]\)</span>。然后重复流程（计算T,向左移位，XOR）直到剩余消息为空，就得到了校验结果。</p>
<p>其运行的伪代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">While(Augmented message非空)</span><br><span class="line">    Begin</span><br><span class="line">        查看寄存器的最高字节，根据其生成控制字节</span><br><span class="line">        根据控制字节产生不同偏移量的Poly,并将其全部进行异或，得到的结果记为T</span><br><span class="line">        将Register左移一个字节，并且将消息的最高字节读入Register的最低字节</span><br><span class="line">        将T低32为与Register进行异或，并将结果写入Register</span><br><span class="line">    End</span><br><span class="line">当前寄存器的值就是余数，即校验码  </span><br></pre></td></tr></table></figure>
<p>就目前而言，这并不比SIMPLE算法好多少。然而，事实证明，大多数计算都可以预先计算并存储到表中。因此，上述算法可以简化为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">While(Augmented message非空)</span><br><span class="line">    Begin</span><br><span class="line">        Top = top_byte(Register);</span><br><span class="line">        Register = (Register &lt;&lt;8 | next_Augmented_message_byte);</span><br><span class="line">        Register = Register XOR precomputed_table[Top];</span><br><span class="line">    End</span><br><span class="line">当前寄存器的值就是余数，即校验码  </span><br></pre></td></tr></table></figure>
<p>如果你理解了这个伪代码的含义，你就掌握了表驱动CRC算法的主要思想。以上是一种非常有效的算法，只需要移位、OR、XOR和以字节为地址的表查找。从图形上看，它看起来像这样：</p>
<img class="kroki" src="https://kroki.io/svgbob/svg/eNqVU01PhEAMvfMrel93srDiyZisF48mGhNPJkMoMBtgDFPQTfjxdvjQQYlAE0rSaV_fm3YAJna0LrDOt-7A3_2F0Hhu0m7P9ttNMtpZd2sT93Cq0wJLwhgKNEamuBGcrel_b32c9DtElmXfyLbyurof2w0Hr49PXjsruf0j2ck7zLIaDk95qitFWeE1SzqGs29aEy7_VfgCnjOVEFCGUGGqDGEFOXIkuqxGYdMldnd1xSgyVmUKqgQJJX5sQRkG1yGJ1YWBgBeDnYRxZHCuDUGlSfI-bNJRE-hkeh2kWUyMn-7w7xZwOjIyytGiBeENHINIkYFG5jUasbya4xYJ4N1y4DoA5sOkOLgah23Us775tYAHzY18UAkUukKQ4xvb0tidqis9CMPZyi9nnuJu">
<p>其参考C代码如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">r=<span class="number">0</span>; </span><br><span class="line"><span class="keyword">while</span> (len--) </span><br><span class="line">&#123; </span><br><span class="line">    byte t = (r &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>; </span><br><span class="line">    r = (r &lt;&lt; <span class="number">8</span>) | *p++; </span><br><span class="line">    r^=table[t]; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优雅版</span></span><br><span class="line">r=<span class="number">0</span>; <span class="keyword">while</span> (len--) r = ((r &lt;&lt; <span class="number">8</span>) | *p++) ^ t[(r &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>];</span><br></pre></td></tr></table></figure>
<p>其中len是补0后消息的长度（以字节为单位），p指向增强消息，r是寄存器，t是临时的，table是计算表。</p>
<h1 id="基于表的crc实现direct-table-algorithm">基于表的CRC实现（DIRECT TABLE ALGORITHM）</h1>
<p>尽管上述的代码只有一行，有一种简洁的美，但是就效率而言，其仍然有优化空间。因为上面基于表的CRC实现的循环判断条件是基于拓展后的消息是否为空，这就导致了需要额外的<span class="math inline">\(\frac{W}{8}\)</span>次循环，现在需要做的就是想办法去避免处理后面补充的零字节。</p>
<p>现在我们回顾一下原本的基于表的CRC实现，其框图如下：</p>
<img class="kroki" src="https://kroki.io/svgbob/svg/eNqVU01PhEAMvfMrel93srDiyZisF48mGhNPJkMoMBtgDFPQTfjxdvjQQYlAE0rSaV_fm3YAJna0LrDOt-7A3_2F0Hhu0m7P9ttNMtpZd2sT93Cq0wJLwhgKNEamuBGcrel_b32c9DtElmXfyLbyurof2w0Hr49PXjsruf0j2ck7zLIaDk95qitFWeE1SzqGs29aEy7_VfgCnjOVEFCGUGGqDGEFOXIkuqxGYdMldnd1xSgyVmUKqgQJJX5sQRkG1yGJ1YWBgBeDnYRxZHCuDUGlSfI-bNJRE-hkeh2kWUyMn-7w7xZwOjIyytGiBeENHINIkYFG5jUasbya4xYJ4N1y4DoA5sOkOLgah23Us775tYAHzY18UAkUukKQ4xvb0tidqis9CMPZyi9nnuJu">
<p>从中我们可以发现如下几点：</p>
<div class="admonition admonition-note">
<p class="admonition-title">TAIL
</p>
<p>额外添加的<span class="math inline">\(\frac{W}{8}=4\)</span>个字节的0也会和Raw Message一样，从右边一个字节一个字节得送入寄存器当中，然而由于其值是0，因此对于Register值没有影响；而且由于最后的<span class="math inline">\(W=32\)</span>比特也不会从Register的左侧移出去，因此不会被用作地址来查表。其根本作用就是为了额外进行<span class="math inline">\(\frac{W}{8}=4\)</span>次迭代，直到所有的Raw Messaage都穿过Register。</p>
</div>
<div class="admonition admonition-note">
<p class="admonition-title">HEAD
</p>
<p>如果寄存器的初始值为0，那么前4次迭代的唯一作用就是将消息的前4个字节完全移入寄存器（因为前32比特都是0，查表得到的值都是0，从而在XOR操作中不改变寄存器的值）。即使寄存器的初始值不是0，前4次迭代的也是将消息的前4个自己完全移入寄存器，然后与一个常数（与寄存器的初值相关）进行异或。</p>
</div>
<p>结合异或的运算性质<span class="math inline">\((A \oplus B) \oplus C = A \oplus (B \oplus C)\)</span>，我们可以假装我们现在处于已经迭代了4次时的状态，即寄存器当中的值为<span class="math inline">\(Raw Message \oplus C\)</span>，其中<span class="math inline">\(C\)</span>就是上面说的与寄存器初值相关的常数，用于记录除法对于<span class="math inline">\(Raw Message\)</span>的影响。因此我们可以将<span class="math inline">\(Raw Message\)</span>单独拎出来，使得寄存器中存储<span class="math inline">\(C\)</span>，并且将后续除法产生的对<span class="math inline">\(Raw Message\)</span>的影响都归并到<span class="math inline">\(C\)</span>中，这就使得<span class="math inline">\((Raw Message &lt;&lt; i) \oplus C\)</span>（i从0开始，每迭代以此增加1）等于原本基于表实现的算法当中的寄存器的值。从而可以得到如下的算法流程图。</p>
<img class="kroki" src="https://kroki.io/svgbob/svg/eNqNU01rwzAMvedX6LjR1jTpeusG22WnMegug7GB2yiJRxoP221W6I-f5Hw0K6W1IDro40lPzxlN2BagK4QXtFbmCKu9QzjaPSxl3ScrrNE6XxMdol1fNWOXsIvZTel7ohobHZr8iOecui55OOeudL6_LgfNAF-Rzyx8us10EEfjtjPRNjQ9O6steixzbZQrNh3rS8WTzi6yaItjAW-Fyhy4AsFgrqxDAyVmfOcQADIWkEUZE4BMVZWDqkCyXIEAm4H6IqQnEcAa8M5O_zSv5ntLb8NoJx2moYtvHejsP_WazsyRRtLJwxWI9k0OGdBKsFdYpiCrCIIWUVWKv-Sp03OSqxLh5mM6TubzT7gVITCzwU18_06WW-xBAzfp7hA08k7Asyb4GFQGG23ojPS7Dm9hxx6HaFyTglY0tbKshGmUUNaTWZu1-APh__Ch">
<div class="admonition admonition-note">
<p class="admonition-title">Note</p>
<p>从上述的定义不难看出，寄存器的初值<span class="math inline">\(C\)</span>是原先基于表的CRC算法经过4次迭代所产生的四次查表结果的不同offset进行异或得到的。其数值可以通过下面的方法计算出来。</p>
<p>设原来基于表实现的CRC算法当中Register的初始值为<span class="math inline">\(I_r\)</span>，而当前算法中Register的初始值为<span class="math inline">\(C\)</span>，那么<span class="math inline">\(C\)</span>在数值上等于以0为初值，<span class="math inline">\(I_r\)</span>为Message的CRC校验值。<br>
而且如果<span class="math inline">\(I_r\)</span>全为0，则<span class="math inline">\(C\)</span>也是全为零</p>
</div>
<p>本算法的C代码如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// r: Register</span></span><br><span class="line"><span class="comment">// len: length of Raw message(unit is byte)</span></span><br><span class="line"><span class="comment">// p: point to Raw message</span></span><br><span class="line"><span class="comment">// t: look up table</span></span><br><span class="line">r=<span class="number">0</span>; <span class="keyword">while</span> (len--) r = (r &lt;&lt;<span class="number">8</span> ) ^ t[(r &gt;&gt; <span class="number">24</span>) ^ *p++];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原来的基于表实现，放在这里是为了进行对比</span></span><br><span class="line"><span class="comment">// r: Register</span></span><br><span class="line"><span class="comment">// len: length of Augmented message(unit is byte)</span></span><br><span class="line"><span class="comment">// p: point to Augmented message</span></span><br><span class="line"><span class="comment">// t: look up table</span></span><br><span class="line">r=<span class="number">0</span>; <span class="keyword">while</span> (len--) r = ((r &lt;&lt; <span class="number">8</span>) | *p++) ^ t[(r &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>];</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>与原来的算法相比，这个算法的循环次数要少4次。</p>
<h1 id="reflected-algorithm">REFLECTED algorithm</h1>
<div class="admonition admonition-question">
<p class="admonition-title">Question</p>
<p>如果这一章没有看明白，可以结合后面的代码实现，会容易理解很多</p>
</div>
<p>尽管上述代码可能已经尽可能地优化了，但这并没有阻止一些有进取心的人把事情变得更加复杂。要了解这是如何发生的，我们必须进入硬件世界。</p>
<div class="admonition admonition-success">
<p class="admonition-title">定义
</p>
<p>一个值或者寄存器的反射（Reflected）就是按位进行颠倒，例如：</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">原始值</th>
<th style="text-align: center;">反射之后的值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0101</td>
<td style="text-align: center;">1010</td>
</tr>
<tr class="even">
<td style="text-align: center;">0011</td>
<td style="text-align: center;">1100</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0111-0101-1010-1111-0010-0101-1011-1100</td>
<td style="text-align: center;">0011-1101-1010-0100-1111-0101-1010-1110</td>
</tr>
</tbody>
</table>
</div>
<p>事实证明，UART（那些执行串行IO的方便的小芯片）习惯于首先传输最低有效位（位0），最后传输最高有效位（位数7）的每个字节（即反射）。这种约定的一个效果是，构建在比特级运行的硬件CRC计算器的硬件工程师需要计算字节流的CRC，每个字节都反映在其内部。字节以相同的顺序处理，但每个字节中的位被交换；位0现在是位7，位1现在是位6，以此类推。详细描述如下：</p>
<p>需要发送的原始消息如下图所示：</p>
<script type="WaveDrom">{reg:[
    {name:"Byte0",bits:8,type:6},
    {name:"Byte1",bits:8,type:6},
    {name:"Byte2",bits:8,type:6},
    {name:"Byte3",bits:8,type:6},
],
config:{label:{right:"Raw Msg"}}
}</script>
<p>根据上述的发送数据的原则，最先发送的是Byte3的LSB，因此经过CRC之后，线路上的数据如下图所示，其中<span class="math inline">\(CheckSum=CRC(\{reflect(Byte3),reflect(Byte2),reflect(Byte1),reflect(Byte0)\})\)</span>，至于为什么CheckSum没有被反射，这是由于硬件CRC的性质决定的。</p>
<script type="WaveDrom">{
reg:[
    {name:"CheckSum",bits:16,tyep:1},
    {name:"reflect(Byte0)",bits:8,type:6},
    {name:"reflect(Byte1)",bits:8,type:6},
    {name:"reflect(Byte2)",bits:8,type:6},
    {name:"reflect(Byte3)",bits:8,type:6},
],
config:{label:{right:"Trans"}}
}</script>
<p>而硬件传递给软件的数据则是：</p>
<script type="WaveDrom">{
reg:[
    {name:"CheckSum",bits:16,tyep:1},
    {name:"Byte0",bits:8,type:6},
    {name:"Byte1",bits:8,type:6},
    {name:"Byte2",bits:8,type:6},
    {name:"Byte3",bits:8,type:6},
],
config:{label:{right:"Recv"}}
}</script>
<p>如果这个约定仅限于硬件领域，这就没什么关系了。然而，在某些时候，这些CRC值可能需要软件来处理，因此必须有人编写一些与硬件CRC兼容的代码。</p>
<p>在这个处境当中，一个正常的软件工程师只需要先将每一个字节反射，然后进行处理就行了。但是，总有些不正常的人，这些人将不反射输入字节，然而反射其他所有的东西。</p>
<img class="kroki" src="https://kroki.io/svgbob/svg/eNpTUPBNLS5OTE9V0MjLz1NILE3PTc0rSU1R0FSw0wUCbS4FAqCGy6myJLUYyDIGcY1AhCGIMICpKIOYoQ02D42AmQGhsBFgZ-hqR_gHEWsMAsRhOhZdQAGXgJ9_iKsVinKgE3ArB4Fn6_ufrVn4bP7SFwtXvNi_9snuxU8n9L3f0_N0fcvTtTOezlzxsnnvsxnrX-yf_WJhz9P-zc-X736_p-PJjt6n_b1PN7Q8n9XybPq2pw0zEWq2LwOr6STsbDyBY0BQBYnxNKhV2OgipVusKugpZWRqCgAnT8K3">
<div class="admonition admonition-note">
<p class="admonition-title">Note</p>
<ul>
<li>The table is identical to the one in the previous algorithm except that each entry has been reflected（table_reflected[i] = reflect(table[reflect(i)])）.</li>
<li>The initial value of the register is the same as in the previous algorithm except that it has been reflected.</li>
<li>The bytes of the message are processed in the same order as before (i.e. the message itself is not reflected).</li>
<li>The message bytes themselves don't need to be explicitly reflected, because everything else has been!</li>
</ul>
</div>
<p>例如下面就是<code>REFLECTED algorithm</code>和正常算法的表的区别，其关系满足上面所说的公式关系：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/* CRC LOOKUP TABLE                                              */</span></span><br><span class="line"><span class="comment">/* ================                                              */</span></span><br><span class="line"><span class="comment">/* The following CRC lookup table was generated automagically    */</span></span><br><span class="line"><span class="comment">/* by the Rocksoft^tm Model CRC Algorithm Table Generation       */</span></span><br><span class="line"><span class="comment">/* Program V1.0 using the following model parameters:            */</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/*    Width   : 4 bytes.                                         */</span></span><br><span class="line"><span class="comment">/*    Poly    : 0x04C11DB7L                                      */</span></span><br><span class="line"><span class="comment">/*    Reverse : FALSE.                                           */</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/* For more information on the Rocksoft^tm Model CRC Algorithm,  */</span></span><br><span class="line"><span class="comment">/* see the document titled &quot;A Painless Guide to CRC Error        */</span></span><br><span class="line"><span class="comment">/* Detection Algorithms&quot; by Ross Williams                        */</span></span><br><span class="line"><span class="comment">/* (ross@guest.adelaide.edu.au.). This document is likely to be  */</span></span><br><span class="line"><span class="comment">/* in the FTP archive &quot;ftp.adelaide.edu.au/pub/rocksoft&quot;.        */</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span>  crctable[<span class="number">256</span>] =</span><br><span class="line">&#123;</span><br><span class="line"> <span class="number">0x00000000</span>L, <span class="number">0x04C11DB7</span>L, <span class="number">0x09823B6E</span>L, <span class="number">0x0D4326D9</span>L,</span><br><span class="line"> <span class="number">0x130476DC</span>L, <span class="number">0x17C56B6B</span>L, <span class="number">0x1A864DB2</span>L, <span class="number">0x1E475005</span>L,</span><br><span class="line"> <span class="number">0x2608EDB8</span>L, <span class="number">0x22C9F00F</span>L, <span class="number">0x2F8AD6D6</span>L, <span class="number">0x2B4BCB61</span>L,</span><br><span class="line"> <span class="number">0x350C9B64</span>L, <span class="number">0x31CD86D3</span>L, <span class="number">0x3C8EA00A</span>L, <span class="number">0x384FBDBD</span>L,</span><br><span class="line"> <span class="number">0x4C11DB70</span>L, <span class="number">0x48D0C6C7</span>L, <span class="number">0x4593E01E</span>L, <span class="number">0x4152FDA9</span>L,</span><br><span class="line"> <span class="number">0x5F15ADAC</span>L, <span class="number">0x5BD4B01B</span>L, <span class="number">0x569796C2</span>L, <span class="number">0x52568B75</span>L,</span><br><span class="line"> <span class="number">0x6A1936C8</span>L, <span class="number">0x6ED82B7F</span>L, <span class="number">0x639B0DA6</span>L, <span class="number">0x675A1011</span>L,</span><br><span class="line"> <span class="number">0x791D4014</span>L, <span class="number">0x7DDC5DA3</span>L, <span class="number">0x709F7B7A</span>L, <span class="number">0x745E66CD</span>L,</span><br><span class="line"> <span class="number">0x9823B6E0</span>L, <span class="number">0x9CE2AB57</span>L, <span class="number">0x91A18D8E</span>L, <span class="number">0x95609039</span>L,</span><br><span class="line"> <span class="number">0x8B27C03C</span>L, <span class="number">0x8FE6DD8B</span>L, <span class="number">0x82A5FB52</span>L, <span class="number">0x8664E6E5</span>L,</span><br><span class="line"> <span class="number">0xBE2B5B58</span>L, <span class="number">0xBAEA46EF</span>L, <span class="number">0xB7A96036</span>L, <span class="number">0xB3687D81</span>L,</span><br><span class="line"> <span class="number">0xAD2F2D84</span>L, <span class="number">0xA9EE3033</span>L, <span class="number">0xA4AD16EA</span>L, <span class="number">0xA06C0B5D</span>L,</span><br><span class="line"> <span class="number">0xD4326D90</span>L, <span class="number">0xD0F37027</span>L, <span class="number">0xDDB056FE</span>L, <span class="number">0xD9714B49</span>L,</span><br><span class="line"> <span class="number">0xC7361B4C</span>L, <span class="number">0xC3F706FB</span>L, <span class="number">0xCEB42022</span>L, <span class="number">0xCA753D95</span>L,</span><br><span class="line"> <span class="number">0xF23A8028</span>L, <span class="number">0xF6FB9D9F</span>L, <span class="number">0xFBB8BB46</span>L, <span class="number">0xFF79A6F1</span>L,</span><br><span class="line"> <span class="number">0xE13EF6F4</span>L, <span class="number">0xE5FFEB43</span>L, <span class="number">0xE8BCCD9A</span>L, <span class="number">0xEC7DD02D</span>L,</span><br><span class="line"> <span class="number">0x34867077</span>L, <span class="number">0x30476DC0</span>L, <span class="number">0x3D044B19</span>L, <span class="number">0x39C556AE</span>L,</span><br><span class="line"> <span class="number">0x278206AB</span>L, <span class="number">0x23431B1C</span>L, <span class="number">0x2E003DC5</span>L, <span class="number">0x2AC12072</span>L,</span><br><span class="line"> <span class="number">0x128E9DCF</span>L, <span class="number">0x164F8078</span>L, <span class="number">0x1B0CA6A1</span>L, <span class="number">0x1FCDBB16</span>L,</span><br><span class="line"> <span class="number">0x018AEB13</span>L, <span class="number">0x054BF6A4</span>L, <span class="number">0x0808D07D</span>L, <span class="number">0x0CC9CDCA</span>L,</span><br><span class="line"> <span class="number">0x7897AB07</span>L, <span class="number">0x7C56B6B0</span>L, <span class="number">0x71159069</span>L, <span class="number">0x75D48DDE</span>L,</span><br><span class="line"> <span class="number">0x6B93DDDB</span>L, <span class="number">0x6F52C06C</span>L, <span class="number">0x6211E6B5</span>L, <span class="number">0x66D0FB02</span>L,</span><br><span class="line"> <span class="number">0x5E9F46BF</span>L, <span class="number">0x5A5E5B08</span>L, <span class="number">0x571D7DD1</span>L, <span class="number">0x53DC6066</span>L,</span><br><span class="line"> <span class="number">0x4D9B3063</span>L, <span class="number">0x495A2DD4</span>L, <span class="number">0x44190B0D</span>L, <span class="number">0x40D816BA</span>L,</span><br><span class="line"> <span class="number">0xACA5C697</span>L, <span class="number">0xA864DB20</span>L, <span class="number">0xA527FDF9</span>L, <span class="number">0xA1E6E04E</span>L,</span><br><span class="line"> <span class="number">0xBFA1B04B</span>L, <span class="number">0xBB60ADFC</span>L, <span class="number">0xB6238B25</span>L, <span class="number">0xB2E29692</span>L,</span><br><span class="line"> <span class="number">0x8AAD2B2F</span>L, <span class="number">0x8E6C3698</span>L, <span class="number">0x832F1041</span>L, <span class="number">0x87EE0DF6</span>L,</span><br><span class="line"> <span class="number">0x99A95DF3</span>L, <span class="number">0x9D684044</span>L, <span class="number">0x902B669D</span>L, <span class="number">0x94EA7B2A</span>L,</span><br><span class="line"> <span class="number">0xE0B41DE7</span>L, <span class="number">0xE4750050</span>L, <span class="number">0xE9362689</span>L, <span class="number">0xEDF73B3E</span>L,</span><br><span class="line"> <span class="number">0xF3B06B3B</span>L, <span class="number">0xF771768C</span>L, <span class="number">0xFA325055</span>L, <span class="number">0xFEF34DE2</span>L,</span><br><span class="line"> <span class="number">0xC6BCF05F</span>L, <span class="number">0xC27DEDE8</span>L, <span class="number">0xCF3ECB31</span>L, <span class="number">0xCBFFD686</span>L,</span><br><span class="line"> <span class="number">0xD5B88683</span>L, <span class="number">0xD1799B34</span>L, <span class="number">0xDC3ABDED</span>L, <span class="number">0xD8FBA05A</span>L,</span><br><span class="line"> <span class="number">0x690CE0EE</span>L, <span class="number">0x6DCDFD59</span>L, <span class="number">0x608EDB80</span>L, <span class="number">0x644FC637</span>L,</span><br><span class="line"> <span class="number">0x7A089632</span>L, <span class="number">0x7EC98B85</span>L, <span class="number">0x738AAD5C</span>L, <span class="number">0x774BB0EB</span>L,</span><br><span class="line"> <span class="number">0x4F040D56</span>L, <span class="number">0x4BC510E1</span>L, <span class="number">0x46863638</span>L, <span class="number">0x42472B8F</span>L,</span><br><span class="line"> <span class="number">0x5C007B8A</span>L, <span class="number">0x58C1663D</span>L, <span class="number">0x558240E4</span>L, <span class="number">0x51435D53</span>L,</span><br><span class="line"> <span class="number">0x251D3B9E</span>L, <span class="number">0x21DC2629</span>L, <span class="number">0x2C9F00F0</span>L, <span class="number">0x285E1D47</span>L,</span><br><span class="line"> <span class="number">0x36194D42</span>L, <span class="number">0x32D850F5</span>L, <span class="number">0x3F9B762C</span>L, <span class="number">0x3B5A6B9B</span>L,</span><br><span class="line"> <span class="number">0x0315D626</span>L, <span class="number">0x07D4CB91</span>L, <span class="number">0x0A97ED48</span>L, <span class="number">0x0E56F0FF</span>L,</span><br><span class="line"> <span class="number">0x1011A0FA</span>L, <span class="number">0x14D0BD4D</span>L, <span class="number">0x19939B94</span>L, <span class="number">0x1D528623</span>L,</span><br><span class="line"> <span class="number">0xF12F560E</span>L, <span class="number">0xF5EE4BB9</span>L, <span class="number">0xF8AD6D60</span>L, <span class="number">0xFC6C70D7</span>L,</span><br><span class="line"> <span class="number">0xE22B20D2</span>L, <span class="number">0xE6EA3D65</span>L, <span class="number">0xEBA91BBC</span>L, <span class="number">0xEF68060B</span>L,</span><br><span class="line"> <span class="number">0xD727BBB6</span>L, <span class="number">0xD3E6A601</span>L, <span class="number">0xDEA580D8</span>L, <span class="number">0xDA649D6F</span>L,</span><br><span class="line"> <span class="number">0xC423CD6A</span>L, <span class="number">0xC0E2D0DD</span>L, <span class="number">0xCDA1F604</span>L, <span class="number">0xC960EBB3</span>L,</span><br><span class="line"> <span class="number">0xBD3E8D7E</span>L, <span class="number">0xB9FF90C9</span>L, <span class="number">0xB4BCB610</span>L, <span class="number">0xB07DABA7</span>L,</span><br><span class="line"> <span class="number">0xAE3AFBA2</span>L, <span class="number">0xAAFBE615</span>L, <span class="number">0xA7B8C0CC</span>L, <span class="number">0xA379DD7B</span>L,</span><br><span class="line"> <span class="number">0x9B3660C6</span>L, <span class="number">0x9FF77D71</span>L, <span class="number">0x92B45BA8</span>L, <span class="number">0x9675461F</span>L,</span><br><span class="line"> <span class="number">0x8832161A</span>L, <span class="number">0x8CF30BAD</span>L, <span class="number">0x81B02D74</span>L, <span class="number">0x857130C3</span>L,</span><br><span class="line"> <span class="number">0x5D8A9099</span>L, <span class="number">0x594B8D2E</span>L, <span class="number">0x5408ABF7</span>L, <span class="number">0x50C9B640</span>L,</span><br><span class="line"> <span class="number">0x4E8EE645</span>L, <span class="number">0x4A4FFBF2</span>L, <span class="number">0x470CDD2B</span>L, <span class="number">0x43CDC09C</span>L,</span><br><span class="line"> <span class="number">0x7B827D21</span>L, <span class="number">0x7F436096</span>L, <span class="number">0x7200464F</span>L, <span class="number">0x76C15BF8</span>L,</span><br><span class="line"> <span class="number">0x68860BFD</span>L, <span class="number">0x6C47164A</span>L, <span class="number">0x61043093</span>L, <span class="number">0x65C52D24</span>L,</span><br><span class="line"> <span class="number">0x119B4BE9</span>L, <span class="number">0x155A565E</span>L, <span class="number">0x18197087</span>L, <span class="number">0x1CD86D30</span>L,</span><br><span class="line"> <span class="number">0x029F3D35</span>L, <span class="number">0x065E2082</span>L, <span class="number">0x0B1D065B</span>L, <span class="number">0x0FDC1BEC</span>L,</span><br><span class="line"> <span class="number">0x3793A651</span>L, <span class="number">0x3352BBE6</span>L, <span class="number">0x3E119D3F</span>L, <span class="number">0x3AD08088</span>L,</span><br><span class="line"> <span class="number">0x2497D08D</span>L, <span class="number">0x2056CD3A</span>L, <span class="number">0x2D15EBE3</span>L, <span class="number">0x29D4F654</span>L,</span><br><span class="line"> <span class="number">0xC5A92679</span>L, <span class="number">0xC1683BCE</span>L, <span class="number">0xCC2B1D17</span>L, <span class="number">0xC8EA00A0</span>L,</span><br><span class="line"> <span class="number">0xD6AD50A5</span>L, <span class="number">0xD26C4D12</span>L, <span class="number">0xDF2F6BCB</span>L, <span class="number">0xDBEE767C</span>L,</span><br><span class="line"> <span class="number">0xE3A1CBC1</span>L, <span class="number">0xE760D676</span>L, <span class="number">0xEA23F0AF</span>L, <span class="number">0xEEE2ED18</span>L,</span><br><span class="line"> <span class="number">0xF0A5BD1D</span>L, <span class="number">0xF464A0AA</span>L, <span class="number">0xF9278673</span>L, <span class="number">0xFDE69BC4</span>L,</span><br><span class="line"> <span class="number">0x89B8FD09</span>L, <span class="number">0x8D79E0BE</span>L, <span class="number">0x803AC667</span>L, <span class="number">0x84FBDBD0</span>L,</span><br><span class="line"> <span class="number">0x9ABC8BD5</span>L, <span class="number">0x9E7D9662</span>L, <span class="number">0x933EB0BB</span>L, <span class="number">0x97FFAD0C</span>L,</span><br><span class="line"> <span class="number">0xAFB010B1</span>L, <span class="number">0xAB710D06</span>L, <span class="number">0xA6322BDF</span>L, <span class="number">0xA2F33668</span>L,</span><br><span class="line"> <span class="number">0xBCB4666D</span>L, <span class="number">0xB8757BDA</span>L, <span class="number">0xB5365D03</span>L, <span class="number">0xB1F740B4</span>L</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"><span class="comment">/*                   End of CRC Lookup Table                     */</span></span><br><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/* CRC LOOKUP TABLE                                              */</span></span><br><span class="line"><span class="comment">/* ================                                              */</span></span><br><span class="line"><span class="comment">/* The following CRC lookup table was generated automagically    */</span></span><br><span class="line"><span class="comment">/* by the Rocksoft^tm Model CRC Algorithm Table Generation       */</span></span><br><span class="line"><span class="comment">/* Program V1.0 using the following model parameters:            */</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/*    Width   : 4 bytes.                                         */</span></span><br><span class="line"><span class="comment">/*    Poly    : 0x04C11DB7L                                      */</span></span><br><span class="line"><span class="comment">/*    Reverse : TRUE.                                            */</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/* For more information on the Rocksoft^tm Model CRC Algorithm,  */</span></span><br><span class="line"><span class="comment">/* see the document titled &quot;A Painless Guide to CRC Error        */</span></span><br><span class="line"><span class="comment">/* Detection Algorithms&quot; by Ross Williams                        */</span></span><br><span class="line"><span class="comment">/* (ross@guest.adelaide.edu.au.). This document is likely to be  */</span></span><br><span class="line"><span class="comment">/* in the FTP archive &quot;ftp.adelaide.edu.au/pub/rocksoft&quot;.        */</span></span><br><span class="line"><span class="comment">/*                                                               */</span></span><br><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span>  crctable[<span class="number">256</span>] =</span><br><span class="line">&#123;</span><br><span class="line"> <span class="number">0x00000000</span>L, <span class="number">0x77073096</span>L, <span class="number">0xEE0E612C</span>L, <span class="number">0x990951BA</span>L,</span><br><span class="line"> <span class="number">0x076DC419</span>L, <span class="number">0x706AF48F</span>L, <span class="number">0xE963A535</span>L, <span class="number">0x9E6495A3</span>L,</span><br><span class="line"> <span class="number">0x0EDB8832</span>L, <span class="number">0x79DCB8A4</span>L, <span class="number">0xE0D5E91E</span>L, <span class="number">0x97D2D988</span>L,</span><br><span class="line"> <span class="number">0x09B64C2B</span>L, <span class="number">0x7EB17CBD</span>L, <span class="number">0xE7B82D07</span>L, <span class="number">0x90BF1D91</span>L,</span><br><span class="line"> <span class="number">0x1DB71064</span>L, <span class="number">0x6AB020F2</span>L, <span class="number">0xF3B97148</span>L, <span class="number">0x84BE41DE</span>L,</span><br><span class="line"> <span class="number">0x1ADAD47D</span>L, <span class="number">0x6DDDE4EB</span>L, <span class="number">0xF4D4B551</span>L, <span class="number">0x83D385C7</span>L,</span><br><span class="line"> <span class="number">0x136C9856</span>L, <span class="number">0x646BA8C0</span>L, <span class="number">0xFD62F97A</span>L, <span class="number">0x8A65C9EC</span>L,</span><br><span class="line"> <span class="number">0x14015C4F</span>L, <span class="number">0x63066CD9</span>L, <span class="number">0xFA0F3D63</span>L, <span class="number">0x8D080DF5</span>L,</span><br><span class="line"> <span class="number">0x3B6E20C8</span>L, <span class="number">0x4C69105E</span>L, <span class="number">0xD56041E4</span>L, <span class="number">0xA2677172</span>L,</span><br><span class="line"> <span class="number">0x3C03E4D1</span>L, <span class="number">0x4B04D447</span>L, <span class="number">0xD20D85FD</span>L, <span class="number">0xA50AB56B</span>L,</span><br><span class="line"> <span class="number">0x35B5A8FA</span>L, <span class="number">0x42B2986C</span>L, <span class="number">0xDBBBC9D6</span>L, <span class="number">0xACBCF940</span>L,</span><br><span class="line"> <span class="number">0x32D86CE3</span>L, <span class="number">0x45DF5C75</span>L, <span class="number">0xDCD60DCF</span>L, <span class="number">0xABD13D59</span>L,</span><br><span class="line"> <span class="number">0x26D930AC</span>L, <span class="number">0x51DE003A</span>L, <span class="number">0xC8D75180</span>L, <span class="number">0xBFD06116</span>L,</span><br><span class="line"> <span class="number">0x21B4F4B5</span>L, <span class="number">0x56B3C423</span>L, <span class="number">0xCFBA9599</span>L, <span class="number">0xB8BDA50F</span>L,</span><br><span class="line"> <span class="number">0x2802B89E</span>L, <span class="number">0x5F058808</span>L, <span class="number">0xC60CD9B2</span>L, <span class="number">0xB10BE924</span>L,</span><br><span class="line"> <span class="number">0x2F6F7C87</span>L, <span class="number">0x58684C11</span>L, <span class="number">0xC1611DAB</span>L, <span class="number">0xB6662D3D</span>L,</span><br><span class="line"> <span class="number">0x76DC4190</span>L, <span class="number">0x01DB7106</span>L, <span class="number">0x98D220BC</span>L, <span class="number">0xEFD5102A</span>L,</span><br><span class="line"> <span class="number">0x71B18589</span>L, <span class="number">0x06B6B51F</span>L, <span class="number">0x9FBFE4A5</span>L, <span class="number">0xE8B8D433</span>L,</span><br><span class="line"> <span class="number">0x7807C9A2</span>L, <span class="number">0x0F00F934</span>L, <span class="number">0x9609A88E</span>L, <span class="number">0xE10E9818</span>L,</span><br><span class="line"> <span class="number">0x7F6A0DBB</span>L, <span class="number">0x086D3D2D</span>L, <span class="number">0x91646C97</span>L, <span class="number">0xE6635C01</span>L,</span><br><span class="line"> <span class="number">0x6B6B51F4</span>L, <span class="number">0x1C6C6162</span>L, <span class="number">0x856530D8</span>L, <span class="number">0xF262004E</span>L,</span><br><span class="line"> <span class="number">0x6C0695ED</span>L, <span class="number">0x1B01A57B</span>L, <span class="number">0x8208F4C1</span>L, <span class="number">0xF50FC457</span>L,</span><br><span class="line"> <span class="number">0x65B0D9C6</span>L, <span class="number">0x12B7E950</span>L, <span class="number">0x8BBEB8EA</span>L, <span class="number">0xFCB9887C</span>L,</span><br><span class="line"> <span class="number">0x62DD1DDF</span>L, <span class="number">0x15DA2D49</span>L, <span class="number">0x8CD37CF3</span>L, <span class="number">0xFBD44C65</span>L,</span><br><span class="line"> <span class="number">0x4DB26158</span>L, <span class="number">0x3AB551CE</span>L, <span class="number">0xA3BC0074</span>L, <span class="number">0xD4BB30E2</span>L,</span><br><span class="line"> <span class="number">0x4ADFA541</span>L, <span class="number">0x3DD895D7</span>L, <span class="number">0xA4D1C46D</span>L, <span class="number">0xD3D6F4FB</span>L,</span><br><span class="line"> <span class="number">0x4369E96A</span>L, <span class="number">0x346ED9FC</span>L, <span class="number">0xAD678846</span>L, <span class="number">0xDA60B8D0</span>L,</span><br><span class="line"> <span class="number">0x44042D73</span>L, <span class="number">0x33031DE5</span>L, <span class="number">0xAA0A4C5F</span>L, <span class="number">0xDD0D7CC9</span>L,</span><br><span class="line"> <span class="number">0x5005713C</span>L, <span class="number">0x270241AA</span>L, <span class="number">0xBE0B1010</span>L, <span class="number">0xC90C2086</span>L,</span><br><span class="line"> <span class="number">0x5768B525</span>L, <span class="number">0x206F85B3</span>L, <span class="number">0xB966D409</span>L, <span class="number">0xCE61E49F</span>L,</span><br><span class="line"> <span class="number">0x5EDEF90E</span>L, <span class="number">0x29D9C998</span>L, <span class="number">0xB0D09822</span>L, <span class="number">0xC7D7A8B4</span>L,</span><br><span class="line"> <span class="number">0x59B33D17</span>L, <span class="number">0x2EB40D81</span>L, <span class="number">0xB7BD5C3B</span>L, <span class="number">0xC0BA6CAD</span>L,</span><br><span class="line"> <span class="number">0xEDB88320</span>L, <span class="number">0x9ABFB3B6</span>L, <span class="number">0x03B6E20C</span>L, <span class="number">0x74B1D29A</span>L,</span><br><span class="line"> <span class="number">0xEAD54739</span>L, <span class="number">0x9DD277AF</span>L, <span class="number">0x04DB2615</span>L, <span class="number">0x73DC1683</span>L,</span><br><span class="line"> <span class="number">0xE3630B12</span>L, <span class="number">0x94643B84</span>L, <span class="number">0x0D6D6A3E</span>L, <span class="number">0x7A6A5AA8</span>L,</span><br><span class="line"> <span class="number">0xE40ECF0B</span>L, <span class="number">0x9309FF9D</span>L, <span class="number">0x0A00AE27</span>L, <span class="number">0x7D079EB1</span>L,</span><br><span class="line"> <span class="number">0xF00F9344</span>L, <span class="number">0x8708A3D2</span>L, <span class="number">0x1E01F268</span>L, <span class="number">0x6906C2FE</span>L,</span><br><span class="line"> <span class="number">0xF762575D</span>L, <span class="number">0x806567CB</span>L, <span class="number">0x196C3671</span>L, <span class="number">0x6E6B06E7</span>L,</span><br><span class="line"> <span class="number">0xFED41B76</span>L, <span class="number">0x89D32BE0</span>L, <span class="number">0x10DA7A5A</span>L, <span class="number">0x67DD4ACC</span>L,</span><br><span class="line"> <span class="number">0xF9B9DF6F</span>L, <span class="number">0x8EBEEFF9</span>L, <span class="number">0x17B7BE43</span>L, <span class="number">0x60B08ED5</span>L,</span><br><span class="line"> <span class="number">0xD6D6A3E8</span>L, <span class="number">0xA1D1937E</span>L, <span class="number">0x38D8C2C4</span>L, <span class="number">0x4FDFF252</span>L,</span><br><span class="line"> <span class="number">0xD1BB67F1</span>L, <span class="number">0xA6BC5767</span>L, <span class="number">0x3FB506DD</span>L, <span class="number">0x48B2364B</span>L,</span><br><span class="line"> <span class="number">0xD80D2BDA</span>L, <span class="number">0xAF0A1B4C</span>L, <span class="number">0x36034AF6</span>L, <span class="number">0x41047A60</span>L,</span><br><span class="line"> <span class="number">0xDF60EFC3</span>L, <span class="number">0xA867DF55</span>L, <span class="number">0x316E8EEF</span>L, <span class="number">0x4669BE79</span>L,</span><br><span class="line"> <span class="number">0xCB61B38C</span>L, <span class="number">0xBC66831A</span>L, <span class="number">0x256FD2A0</span>L, <span class="number">0x5268E236</span>L,</span><br><span class="line"> <span class="number">0xCC0C7795</span>L, <span class="number">0xBB0B4703</span>L, <span class="number">0x220216B9</span>L, <span class="number">0x5505262F</span>L,</span><br><span class="line"> <span class="number">0xC5BA3BBE</span>L, <span class="number">0xB2BD0B28</span>L, <span class="number">0x2BB45A92</span>L, <span class="number">0x5CB36A04</span>L,</span><br><span class="line"> <span class="number">0xC2D7FFA7</span>L, <span class="number">0xB5D0CF31</span>L, <span class="number">0x2CD99E8B</span>L, <span class="number">0x5BDEAE1D</span>L,</span><br><span class="line"> <span class="number">0x9B64C2B0</span>L, <span class="number">0xEC63F226</span>L, <span class="number">0x756AA39C</span>L, <span class="number">0x026D930A</span>L,</span><br><span class="line"> <span class="number">0x9C0906A9</span>L, <span class="number">0xEB0E363F</span>L, <span class="number">0x72076785</span>L, <span class="number">0x05005713</span>L,</span><br><span class="line"> <span class="number">0x95BF4A82</span>L, <span class="number">0xE2B87A14</span>L, <span class="number">0x7BB12BAE</span>L, <span class="number">0x0CB61B38</span>L,</span><br><span class="line"> <span class="number">0x92D28E9B</span>L, <span class="number">0xE5D5BE0D</span>L, <span class="number">0x7CDCEFB7</span>L, <span class="number">0x0BDBDF21</span>L,</span><br><span class="line"> <span class="number">0x86D3D2D4</span>L, <span class="number">0xF1D4E242</span>L, <span class="number">0x68DDB3F8</span>L, <span class="number">0x1FDA836E</span>L,</span><br><span class="line"> <span class="number">0x81BE16CD</span>L, <span class="number">0xF6B9265B</span>L, <span class="number">0x6FB077E1</span>L, <span class="number">0x18B74777</span>L,</span><br><span class="line"> <span class="number">0x88085AE6</span>L, <span class="number">0xFF0F6A70</span>L, <span class="number">0x66063BCA</span>L, <span class="number">0x11010B5C</span>L,</span><br><span class="line"> <span class="number">0x8F659EFF</span>L, <span class="number">0xF862AE69</span>L, <span class="number">0x616BFFD3</span>L, <span class="number">0x166CCF45</span>L,</span><br><span class="line"> <span class="number">0xA00AE278</span>L, <span class="number">0xD70DD2EE</span>L, <span class="number">0x4E048354</span>L, <span class="number">0x3903B3C2</span>L,</span><br><span class="line"> <span class="number">0xA7672661</span>L, <span class="number">0xD06016F7</span>L, <span class="number">0x4969474D</span>L, <span class="number">0x3E6E77DB</span>L,</span><br><span class="line"> <span class="number">0xAED16A4A</span>L, <span class="number">0xD9D65ADC</span>L, <span class="number">0x40DF0B66</span>L, <span class="number">0x37D83BF0</span>L,</span><br><span class="line"> <span class="number">0xA9BCAE53</span>L, <span class="number">0xDEBB9EC5</span>L, <span class="number">0x47B2CF7F</span>L, <span class="number">0x30B5FFE9</span>L,</span><br><span class="line"> <span class="number">0xBDBDF21C</span>L, <span class="number">0xCABAC28A</span>L, <span class="number">0x53B39330</span>L, <span class="number">0x24B4A3A6</span>L,</span><br><span class="line"> <span class="number">0xBAD03605</span>L, <span class="number">0xCDD70693</span>L, <span class="number">0x54DE5729</span>L, <span class="number">0x23D967BF</span>L,</span><br><span class="line"> <span class="number">0xB3667A2E</span>L, <span class="number">0xC4614AB8</span>L, <span class="number">0x5D681B02</span>L, <span class="number">0x2A6F2B94</span>L,</span><br><span class="line"> <span class="number">0xB40BBE37</span>L, <span class="number">0xC30C8EA1</span>L, <span class="number">0x5A05DF1B</span>L, <span class="number">0x2D02EF8D</span>L</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"><span class="comment">/*                   End of CRC Lookup Table                     */</span></span><br><span class="line"><span class="comment">/*****************************************************************/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在执行结束之后，寄存器留下的值就相当于反射后的消息经过非反射的算法后所得到的结果，再对结果进行反射的值（即对应着Rocksoft模型中的<code>Refin=TRUE</code>和<code>Refot=TRUE</code>），如果没看明白可以看看后面的<a href="#基于表的crc实现">C代码</a>。</p>
<h1 id="多项式反转reversed-polys">多项式反转（Reversed Polys）</h1>
<p>事实证明，一个好的多项式，其反射也是一个好的多项式。也就是说，如果<span class="math inline">\(G=11101\)</span>有不错的效果，那么<span class="math inline">\(G=10111\)</span>的效果也很好。因此，似乎每次一个组织（如CCITT）对一个特别好的多项式进行标准化时，在实际使用过程中，人们也不会放过该多项式的反射。因此，一组“标准”多项式有一组相应的反射，这些反射也在使用中。</p>
<p>为了避免迷惑，我们在这里称之为多项式反转（reversed poly）.</p>
<div class="admonition admonition-example">
<p class="admonition-title">Example</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">标准</th>
<th style="text-align: center;">多项式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">X25 standard</td>
<td style="text-align: center;">1-0001-0000-0010-0001</td>
</tr>
<tr class="even">
<td style="text-align: center;">X25 reversed</td>
<td style="text-align: center;">1-0000-1000-0001-0001</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CRC16 standard</td>
<td style="text-align: center;">1-1000-0000-0000-0101</td>
</tr>
<tr class="even">
<td style="text-align: center;">CRC16 reversed</td>
<td style="text-align: center;">1-0100-0000-0000-0011</td>
</tr>
</tbody>
</table>
</div>
<p>请注意，这里反射（反转）的是整个多项式，而不仅仅是底部的<span class="math inline">\(W\)</span>位。这是一个重要的区别。在前一节描述的反射算法中，反射算法中使用的多项式实际上与非反射算法中的多项式的反射是反射底部的<span class="math inline">\(W\)</span>位，而不包含最高位隐藏<span class="math inline">\(1\)</span>。相比之下，反转多项式是包含最高位的<span class="math inline">\(1\)</span>的。</p>
<h1 id="初始化和最终值">初始化和最终值</h1>
<p>除了上述复杂性之外，CRC算法在另外两个方面也有所不同：</p>
<ol type="1">
<li>寄存器初始值</li>
<li>输出异或值（与最终的寄存器值进行异或）</li>
</ol>
<p>例如CRC32使用<span class="math inline">\(FFFFFFFF\)</span>初始化寄存器，并且使用<span class="math inline">\(FFFFFFFF\)</span>对最终的寄存器值进行异或。</p>
<p>大部分的CRC算法都将寄存器初始化为0，但是还是存在初始化为非0的情况。就理论上来说（messgage完全随机），初始值的选择不影响CRC 算法的有效性，初始值仅仅提供了一个寄存器值开始运算的固定起点。然而，在实践中，有些信息出现的可能性要更高，因此把CRC 寄存器初始化为一个不太可能在实际中出现“盲点” 的值是更明智的。“盲点” 是指一系列不会导致CRC 寄存器值变化的信息字节。特别是当CRC 寄存器被初始化为0 时就具有“零盲点”，当它运行的时候就不知道前面有多少个零字节。而零字节在实际应用中充当信息的前导字节是非常普遍的，所以把CRC 寄存器初始化为非零值是一个明智的做法。</p>
<h1 id="算法的定义">算法的定义</h1>
<p>至此，我们已经介绍了表驱动CRC算法的所有不同方面。由于这些算法有很多变体，因此值得尝试为它们建立一个命名法。这就是本章节的目的。</p>
<p>从上面的讨论我们可以看出，CRC算法主要由下面几个参数决定：</p>
<ul>
<li>多项式的宽度</li>
<li>多项式的值</li>
<li>寄存器的初始值</li>
<li>输入数据的每个字节是否需要反射</li>
<li>算法是直接表算法（DIRECT TABLE ALGORITHM）还是间接表算法(TABLE ALGORITHM)</li>
<li>最终寄存器的值是否需要被反射</li>
<li>输出异或值（与最终CRC值进行异或）</li>
</ul>
<p>为了能够讨论特定的CRC算法，我们需要能够更精确地定义它们。因此，下一节将尝试为CRC算法提供一个定义良好的参数化模型。要引用特定的算法，我们只需根据模型的参数指定算法。</p>
<h1 id="crc参数化模型rocksoft">CRC参数化模型（Rocksoft™）</h1>
<p>在本节中，我们定义了一个精确的参数化模型CRC算法，我们将称之为“Rocksoft™ Model CRC Algorithm”，这个模型最重要的一点就是它忽略了所有的具体实现，而只关注于功能。而构建这么一个模型则是为了能够精确引用特定的CRC算法，而不用管其具体实现是多么的复杂和混乱。因此模型应该简单精确，不会造成混淆。</p>
<div class="markdown-alert markdown-alert-important" dir="auto"><p class="markdown-alert-title" dir="auto"><svg class="octicon octicon-report mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p dir="auto">
Rocksoft™模型本质上是基于DIRECT TABLE ALGORITHM的，但是该模型也被进一步参数化了，使得其能够表征更加复杂的和混乱的现实算法</p></div>
<p>为了能够表征反射算法，本模型提供了两个bool值选项，其中一个用来控制输入字节是否反射，另一个用来控制输出的校验值是否反射。还有一个参数用于指定寄存器的初始值，已经一个用于指定输出异或值的参数。</p>
<p>总的来说Rocksoft™模型的参数如下表：</p>
<table>
<caption>Rocksoft™模型参数表</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 84%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">参数名称</th>
<th style="text-align: center;">参数类型</th>
<th style="text-align: center;">参数意义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">NAME</td>
<td style="text-align: center;">字符串</td>
<td style="text-align: center;">算法的名称</td>
</tr>
<tr class="even">
<td style="text-align: center;">WIDTH</td>
<td style="text-align: center;">十进制数</td>
<td style="text-align: center;">算法宽度（以bit为单位）。比多项式的位数少1，因为多项式首字节有隐藏的1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">POLY</td>
<td style="text-align: center;"><span style="white-space: nowrap;">十六进制数</span></td>
<td style="text-align: center;">多项式所对应的二进制数的十六进制表示，并且忽略最高位的1，例如多项式<span class="math inline">\(10110\)</span>则表示为<span class="math inline">\(06\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">INIT</td>
<td style="text-align: center;">十六进制数</td>
<td style="text-align: center;">DIRECT TABLE ALGORITHM中的寄存器初值。如果使用的是TALBE ALGORITHM则需要将其转换，才能使结果一致</td>
</tr>
<tr class="odd">
<td style="text-align: center;">REFIN</td>
<td style="text-align: center;">布尔值</td>
<td style="text-align: center;">如果等于True，则反射输入Message的每个字节</td>
</tr>
<tr class="even">
<td style="text-align: center;">REFOUR</td>
<td style="text-align: center;">布尔值</td>
<td style="text-align: center;">如果等于False，则直接将寄存器中的值送入XOR阶段，否则，先将寄存器中的值进行反射，然后送入XOR阶段</td>
</tr>
<tr class="odd">
<td style="text-align: center;">XOROUT</td>
<td style="text-align: center;">十六进制数</td>
<td style="text-align: center;"><span class="math inline">\(W\)</span> bit宽的数，将异或之后的结果作为最终的校验值</td>
</tr>
<tr class="even">
<td style="text-align: center;">CHECK</td>
<td style="text-align: center;">十六进制数</td>
<td style="text-align: center;">这个不是必须的，主要是用来作为检查的，其值等于上述参数描述的算法，对字符串"123456789"产生的校验值</td>
</tr>
</tbody>
</table>
<p>定义了这些参数后，该模型现在可用于精确指定特定的CRC算法。以下是CRC-16算法的一种流行形式的示例规范。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">参数名称</th>
<th style="text-align: center;">参数值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">NAME</td>
<td style="text-align: center;">“CRC-16”</td>
</tr>
<tr class="even">
<td style="text-align: center;">WIDTH</td>
<td style="text-align: center;">16</td>
</tr>
<tr class="odd">
<td style="text-align: center;">POLY</td>
<td style="text-align: center;">8005</td>
</tr>
<tr class="even">
<td style="text-align: center;">INIT</td>
<td style="text-align: center;">0000</td>
</tr>
<tr class="odd">
<td style="text-align: center;">REFIN</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="even">
<td style="text-align: center;">REFOUR</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="odd">
<td style="text-align: center;">XOROUT</td>
<td style="text-align: center;">0000</td>
</tr>
<tr class="even">
<td style="text-align: center;">CHECK</td>
<td style="text-align: center;">BB3D</td>
</tr>
</tbody>
</table>
<p>以及CRC-32算法（据说是用于PKZip, AUTODIN II, Ethernet, 和 FDDI）。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">参数名称</th>
<th style="text-align: center;">参数值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Name</td>
<td style="text-align: center;">"CRC-32"</td>
</tr>
<tr class="even">
<td style="text-align: center;">Width</td>
<td style="text-align: center;">32</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Poly</td>
<td style="text-align: center;">04C11DB7</td>
</tr>
<tr class="even">
<td style="text-align: center;">Init</td>
<td style="text-align: center;">FFFFFFFF</td>
</tr>
<tr class="odd">
<td style="text-align: center;">RefIn</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="even">
<td style="text-align: center;">RefOut</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="odd">
<td style="text-align: center;">XorOut</td>
<td style="text-align: center;">FFFFFFFF</td>
</tr>
<tr class="even">
<td style="text-align: center;">Check</td>
<td style="text-align: center;">CBF43926</td>
</tr>
</tbody>
</table>
<h1 id="rocksoft模型的参考实现">Rocksoft™模型的参考实现</h1>
<p>这是用C编程语言实现的模型算法。该实现由一个头文件（.h）和一个实现文件（.c）组成。如果想验证本代码的正确性，可以将其配置称上述的CRC-16和CRC-32，然后使用“123456789”作为message，然后将产生的结果与上述表中的<code>Check</code>进行比较。</p>
<figure class="highlight c"><figcaption><span>crcmodel.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                             Start of crcmodel.h                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Author : Ross Williams (ross@guest.adelaide.edu.au.).                      */</span></span><br><span class="line"><span class="comment">/* Date   : 3 June 1993.                                                      */</span></span><br><span class="line"><span class="comment">/* Status : Public domain.                                                    */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Description : This is the header (.h) file for the reference               */</span></span><br><span class="line"><span class="comment">/* implementation of the Rocksoft^tm Model CRC Algorithm. For more            */</span></span><br><span class="line"><span class="comment">/* information on the Rocksoft^tm Model CRC Algorithm, see the document       */</span></span><br><span class="line"><span class="comment">/* titled &quot;A Painless Guide to CRC Error Detection Algorithms&quot; by Ross        */</span></span><br><span class="line"><span class="comment">/* Williams (ross@guest.adelaide.edu.au.). This document is likely to be in   */</span></span><br><span class="line"><span class="comment">/* &quot;ftp.adelaide.edu.au/pub/rocksoft&quot;.                                        */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Note: Rocksoft is a trademark of Rocksoft Pty Ltd, Adelaide, Australia.    */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* How to Use This Package                                                    */</span></span><br><span class="line"><span class="comment">/* -----------------------                                                    */</span></span><br><span class="line"><span class="comment">/* Step 1: Declare a variable of type cm_t. Declare another variable          */</span></span><br><span class="line"><span class="comment">/*         (p_cm say) of type p_cm_t and initialize it to point to the first  */</span></span><br><span class="line"><span class="comment">/*         variable (e.g. p_cm_t p_cm = &amp;cm_t).                               */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Step 2: Assign values to the parameter fields of the structure.            */</span></span><br><span class="line"><span class="comment">/*         If you don&#x27;t know what to assign, see the document cited earlier.  */</span></span><br><span class="line"><span class="comment">/*         For example:                                                       */</span></span><br><span class="line"><span class="comment">/*            p_cm-&gt;cm_width = 16;                                            */</span></span><br><span class="line"><span class="comment">/*            p_cm-&gt;cm_poly  = 0x8005L;                                       */</span></span><br><span class="line"><span class="comment">/*            p_cm-&gt;cm_init  = 0L;                                            */</span></span><br><span class="line"><span class="comment">/*            p_cm-&gt;cm_refin = TRUE;                                          */</span></span><br><span class="line"><span class="comment">/*            p_cm-&gt;cm_refot = TRUE;                                          */</span></span><br><span class="line"><span class="comment">/*            p_cm-&gt;cm_xorot = 0L;                                            */</span></span><br><span class="line"><span class="comment">/*         Note: Poly is specified without its top bit (18005 becomes 8005).  */</span></span><br><span class="line"><span class="comment">/*         Note: Width is one bit less than the raw poly width.               */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Step 3: Initialize the instance with a call cm_ini(p_cm);                  */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Step 4: Process zero or more message bytes by placing zero or more         */</span></span><br><span class="line"><span class="comment">/*         successive calls to cm_nxt. Example: cm_nxt(p_cm,ch);              */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Step 5: Extract the CRC value at any time by calling crc = cm_crc(p_cm);   */</span></span><br><span class="line"><span class="comment">/*         If the CRC is a 16-bit value, it will be in the bottom 16 bits.    */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Design Notes                                                               */</span></span><br><span class="line"><span class="comment">/* ------------                                                               */</span></span><br><span class="line"><span class="comment">/* PORTABILITY: This package has been coded very conservatively so that       */</span></span><br><span class="line"><span class="comment">/* it will run on as many machines as possible. For example, all external     */</span></span><br><span class="line"><span class="comment">/* identifiers have been restricted to 6 characters and all internal ones to  */</span></span><br><span class="line"><span class="comment">/* 8 characters. The prefix cm (for Crc Model) is used as an attempt to avoid */</span></span><br><span class="line"><span class="comment">/* namespace collisions. This package is endian independent.                  */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* EFFICIENCY: This package (and its interface) is not designed for           */</span></span><br><span class="line"><span class="comment">/* speed. The purpose of this package is to act as a well-defined reference   */</span></span><br><span class="line"><span class="comment">/* model for the specification of CRC algorithms. If you want speed, cook up  */</span></span><br><span class="line"><span class="comment">/* a specific table-driven implementation as described in the document cited  */</span></span><br><span class="line"><span class="comment">/* above. This package is designed for validation only; if you have found or  */</span></span><br><span class="line"><span class="comment">/* implemented a CRC algorithm and wish to describe it as a set of parameters */</span></span><br><span class="line"><span class="comment">/* to the Rocksoft^tm Model CRC Algorithm, your CRC algorithm implementation  */</span></span><br><span class="line"><span class="comment">/* should behave identically to this package under those parameters.          */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The following #ifndef encloses this entire */</span></span><br><span class="line"><span class="comment">/* header file, rendering it indempotent.     */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CM_DONE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CM_DONE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The following definitions are extracted from my style header file which    */</span></span><br><span class="line"><span class="comment">/* would be cumbersome to distribute with this package. The DONE_STYLE is the */</span></span><br><span class="line"><span class="comment">/* idempotence symbol used in my style header file.                           */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DONE_STYLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> ulong;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">bool</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span>* p_ubyte_;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> TRUE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FALSE 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TRUE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Change to the second definition if you don&#x27;t have prototypes. */</span></span><br><span class="line"><span class="comment">// #define P_(A) A</span></span><br><span class="line"><span class="comment">/* #define P_(A) () */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Uncomment this definition if you don&#x27;t have void. */</span></span><br><span class="line"><span class="comment">/* typedef int void; */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* CRC Model Abstract Type */</span></span><br><span class="line"><span class="comment">/* ----------------------- */</span></span><br><span class="line"><span class="comment">/* The following type stores the context of an executing instance of the  */</span></span><br><span class="line"><span class="comment">/* model algorithm. Most of the fields are model parameters which must be */</span></span><br><span class="line"><span class="comment">/* set before the first initializing call to cm_ini.                      */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> cm_width; <span class="comment">/* Parameter: Width in bits [8,32].       */</span></span><br><span class="line">    ulong cm_poly; <span class="comment">/* Parameter: The algorithm&#x27;s polynomial. */</span></span><br><span class="line">    ulong cm_init; <span class="comment">/* Parameter: Initial register value.     */</span></span><br><span class="line">    <span class="type">bool</span> cm_refin; <span class="comment">/* Parameter: Reflect input bytes?        */</span></span><br><span class="line">    <span class="type">bool</span> cm_refot; <span class="comment">/* Parameter: Reflect output CRC?         */</span></span><br><span class="line">    ulong cm_xorot; <span class="comment">/* Parameter: XOR this to output CRC.     */</span></span><br><span class="line"></span><br><span class="line">    ulong cm_reg; <span class="comment">/* Context: Context during execution.     */</span></span><br><span class="line">&#125; <span class="type">cm_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">cm_t</span>* <span class="type">p_cm_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Functions That Implement The Model */</span></span><br><span class="line"><span class="comment">/* ---------------------------------- */</span></span><br><span class="line"><span class="comment">/* The following functions animate the cm_t abstraction. */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">cm_ini</span><span class="params">(<span class="type">p_cm_t</span> p_cm)</span>;</span><br><span class="line"><span class="comment">/* Initializes the argument CRC model instance.          */</span></span><br><span class="line"><span class="comment">/* All parameter fields must be set before calling this. */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">cm_nxt</span><span class="params">(<span class="type">p_cm_t</span> p_cm, <span class="type">int</span> ch)</span>;</span><br><span class="line"><span class="comment">/* Processes a single message byte [0,255]. */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">cm_blk</span><span class="params">(<span class="type">p_cm_t</span> p_cm, p_ubyte_ blk_adr, ulong blk_len)</span>;</span><br><span class="line"><span class="comment">/* Processes a block of message bytes. */</span></span><br><span class="line"></span><br><span class="line">ulong <span class="title function_">cm_crc</span><span class="params">(<span class="type">p_cm_t</span> p_cm)</span>;</span><br><span class="line"><span class="comment">/* Returns the CRC value for the message bytes processed so far. */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Functions For Table Calculation */</span></span><br><span class="line"><span class="comment">/* ------------------------------- */</span></span><br><span class="line"><span class="comment">/* The following function can be used to calculate a CRC lookup table.        */</span></span><br><span class="line"><span class="comment">/* It can also be used at run-time to create or check static tables.          */</span></span><br><span class="line"></span><br><span class="line">ulong <span class="title function_">cm_tab</span><span class="params">(<span class="type">p_cm_t</span> p_cm, <span class="type">int</span> index)</span>;</span><br><span class="line"><span class="comment">/* Returns the i&#x27;th entry for the lookup table for the specified algorithm.   */</span></span><br><span class="line"><span class="comment">/* The function examines the fields cm_width, cm_poly, cm_refin, and the      */</span></span><br><span class="line"><span class="comment">/* argument table index in the range [0,255] and returns the table entry in   */</span></span><br><span class="line"><span class="comment">/* the bottom cm_width bytes of the return value.                             */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* End of the header file idempotence #ifndef */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                             End of crcmodel.h                              */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><figcaption><span>crcmodel.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                             Start of crcmodel.c                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Author : Ross Williams (ross@guest.adelaide.edu.au.).                      */</span></span><br><span class="line"><span class="comment">/* Date   : 3 June 1993.                                                      */</span></span><br><span class="line"><span class="comment">/* Status : Public domain.                                                    */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Description : This is the implementation (.c) file for the reference       */</span></span><br><span class="line"><span class="comment">/* implementation of the Rocksoft^tm Model CRC Algorithm. For more            */</span></span><br><span class="line"><span class="comment">/* information on the Rocksoft^tm Model CRC Algorithm, see the document       */</span></span><br><span class="line"><span class="comment">/* titled &quot;A Painless Guide to CRC Error Detection Algorithms&quot; by Ross        */</span></span><br><span class="line"><span class="comment">/* Williams (ross@guest.adelaide.edu.au.). This document is likely to be in   */</span></span><br><span class="line"><span class="comment">/* &quot;ftp.adelaide.edu.au/pub/rocksoft&quot;.                                        */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Note: Rocksoft is a trademark of Rocksoft Pty Ltd, Adelaide, Australia.    */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Implementation Notes                                                       */</span></span><br><span class="line"><span class="comment">/* --------------------                                                       */</span></span><br><span class="line"><span class="comment">/* To avoid inconsistencies, the specification of each function is not echoed */</span></span><br><span class="line"><span class="comment">/* here. See the header file for a description of these functions.            */</span></span><br><span class="line"><span class="comment">/* This package is light on checking because I want to keep it short and      */</span></span><br><span class="line"><span class="comment">/* simple and portable (i.e. it would be too messy to distribute my entire    */</span></span><br><span class="line"><span class="comment">/* C culture (e.g. assertions package) with this package.                     */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;crcmodel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The following definitions make the code more readable. */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BITMASK(X) (1L &lt;&lt; (X))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MASK32 0xFFFFFFFFL</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOCAL static</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Returns the value v with the bottom b [0,32] bits reflected. */</span></span><br><span class="line"><span class="comment">/* Example: reflect(0x3e23L,3) == 0x3e26                        */</span></span><br><span class="line">LOCAL ulong <span class="title function_">reflect</span><span class="params">(ulong v, <span class="type">int</span> b)</span>;</span><br><span class="line">LOCAL ulong <span class="title function_">reflect</span><span class="params">(ulong v, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    ulong t = v;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; b; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (t &amp; <span class="number">1L</span>)</span><br><span class="line">            v |= BITMASK((b - <span class="number">1</span>) - i);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            v &amp;= ~BITMASK((b - <span class="number">1</span>) - i);</span><br><span class="line">        t &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Returns a longword whose value is (2^p_cm-&gt;cm_width)-1.     */</span></span><br><span class="line"><span class="comment">/* The trick is to do this portably (e.g. without doing &lt;&lt;32). */</span></span><br><span class="line">LOCAL ulong <span class="title function_">widmask</span><span class="params">(<span class="type">p_cm_t</span>)</span>;</span><br><span class="line">LOCAL ulong <span class="title function_">widmask</span><span class="params">(<span class="type">p_cm_t</span> p_cm)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (((<span class="number">1L</span> &lt;&lt; (p_cm-&gt;cm_width - <span class="number">1</span>)) - <span class="number">1L</span>) &lt;&lt; <span class="number">1</span>) | <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">cm_ini</span><span class="params">(<span class="type">p_cm_t</span> p_cm)</span></span><br><span class="line">&#123;</span><br><span class="line">    p_cm-&gt;cm_reg = p_cm-&gt;cm_init;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">cm_nxt</span><span class="params">(<span class="type">p_cm_t</span> p_cm, <span class="type">int</span> ch)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    ulong uch = (ulong)ch;</span><br><span class="line">    ulong topbit = BITMASK(p_cm-&gt;cm_width - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p_cm-&gt;cm_refin)</span><br><span class="line">        uch = reflect(uch, <span class="number">8</span>);</span><br><span class="line">    p_cm-&gt;cm_reg ^= (uch &lt;&lt; (p_cm-&gt;cm_width - <span class="number">8</span>));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p_cm-&gt;cm_reg &amp; topbit)</span><br><span class="line">            p_cm-&gt;cm_reg = (p_cm-&gt;cm_reg &lt;&lt; <span class="number">1</span>) ^ p_cm-&gt;cm_poly;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p_cm-&gt;cm_reg &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        p_cm-&gt;cm_reg &amp;= widmask(p_cm);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">cm_blk</span><span class="params">(<span class="type">p_cm_t</span> p_cm, p_ubyte_ blk_adr, ulong blk_len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (blk_len--)</span><br><span class="line">        cm_nxt(p_cm, *blk_adr++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line">ulong <span class="title function_">cm_crc</span><span class="params">(<span class="type">p_cm_t</span> p_cm)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (p_cm-&gt;cm_refot)</span><br><span class="line">        <span class="keyword">return</span> p_cm-&gt;cm_xorot ^ reflect(p_cm-&gt;cm_reg, p_cm-&gt;cm_width);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> p_cm-&gt;cm_xorot ^ p_cm-&gt;cm_reg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line">ulong <span class="title function_">cm_tab</span><span class="params">(<span class="type">p_cm_t</span> p_cm, <span class="type">int</span> index)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    ulong r;</span><br><span class="line">    ulong topbit = BITMASK(p_cm-&gt;cm_width - <span class="number">1</span>);</span><br><span class="line">    ulong inbyte = (ulong)index;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p_cm-&gt;cm_refin)</span><br><span class="line">        inbyte = reflect(inbyte, <span class="number">8</span>);</span><br><span class="line">    r = inbyte &lt;&lt; (p_cm-&gt;cm_width - <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        <span class="keyword">if</span> (r &amp; topbit)</span><br><span class="line">            r = (r &lt;&lt; <span class="number">1</span>) ^ p_cm-&gt;cm_poly;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            r &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (p_cm-&gt;cm_refin)</span><br><span class="line">        r = reflect(r, p_cm-&gt;cm_width);</span><br><span class="line">    <span class="keyword">return</span> r &amp; widmask(p_cm);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                             End of crcmodel.c                              */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><figcaption><span>check.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;crcmodel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span>* Benchmark = <span class="string">&quot;123456789&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Checking CRC using string \&quot;123456789\&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CRC-16</span></span><br><span class="line">    <span class="type">cm_t</span> crc16 = &#123;</span><br><span class="line">        .cm_init = <span class="number">0x0000</span>,</span><br><span class="line">        .cm_poly = <span class="number">0x8005</span>,</span><br><span class="line">        .cm_refin = TRUE,</span><br><span class="line">        .cm_refot = TRUE,</span><br><span class="line">        .cm_width = <span class="number">16</span>,</span><br><span class="line">        .cm_xorot = <span class="number">0x0000</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CRC-32</span></span><br><span class="line">    <span class="type">cm_t</span> crc32 = &#123;</span><br><span class="line">        .cm_init = <span class="number">0xffffffff</span>,</span><br><span class="line">        .cm_poly = <span class="number">0x04c11db7</span>,</span><br><span class="line">        .cm_refin = TRUE,</span><br><span class="line">        .cm_refot = TRUE,</span><br><span class="line">        .cm_width = <span class="number">32</span>,</span><br><span class="line">        .cm_xorot = <span class="number">0xffffffff</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">p_cm_t</span> p_crc16 = &amp;crc16;</span><br><span class="line">    <span class="type">p_cm_t</span> p_crc32 = &amp;crc32;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置初始化的值</span></span><br><span class="line">    cm_ini(p_crc16);</span><br><span class="line">    cm_ini(p_crc32);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算</span></span><br><span class="line">    cm_blk(p_crc16, (<span class="type">unsigned</span> <span class="type">char</span>*)Benchmark, <span class="built_in">strlen</span>(Benchmark));</span><br><span class="line">    cm_blk(p_crc32, (<span class="type">unsigned</span> <span class="type">char</span>*)Benchmark, <span class="built_in">strlen</span>(Benchmark));</span><br><span class="line"></span><br><span class="line">    ulong checksum16 = cm_crc(p_crc16);</span><br><span class="line">    ulong checksum32 = cm_crc(p_crc32);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;crc 16 : 0x%lx\n&quot;</span>, checksum16);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;crc 32 : 0x%lx\n&quot;</span>, checksum32);</span><br><span class="line"></span><br><span class="line">    assert(checksum16 == <span class="number">0xbb3d</span>);</span><br><span class="line">    assert(checksum32 == <span class="number">0xcbf43926</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\e[1;32mcheck pass !!!\e[0m\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行参考模型</span></span><br><span class="line"><span class="section">run_reference:check.c crcmodel.c</span></span><br><span class="line">	@gcc -g <span class="variable">$^</span> -Wall -Werror -o reference &amp;&amp; ./reference</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成查找表</span></span><br><span class="line"><span class="section">gen_table:crctable.c crcmodel.c</span></span><br><span class="line">	@gcc -g <span class="variable">$^</span> -Wall -Werror -o gen_table &amp;&amp; ./gen_table</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行表驱动算法</span></span><br><span class="line"><span class="section">table_driven:crc32_table_driven.c gen_table</span></span><br><span class="line">	@gcc -g <span class="variable">$&lt;</span> -Wall -Werror -o table_driven &amp;&amp; ./table_driven</span><br><span class="line"></span><br><span class="line"><span class="section">all: run_reference table_driven</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm crctable reference gen_table table_driven</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="基于表的crc实现">基于表的CRC实现</h1>
<p>尽管上面我介绍了很多细节用以理解和定义CRC算法，但是CRC的高速实现并没有那么复杂。总的来说，其高速实现其实 只有两种形式——<code>normal</code>和<code>reflected</code>。其中<code>normal</code>向左移动寄存器（对应着Rocksoft模型中<code>Refin=FALSE</code>和<code>Refot=FALSE</code>），而<code>reflected</code>向右移动寄存器（对应着Rocksoft模型中<code>Refin=TRUE</code>和<code>Refot=TRUE</code>）。如果我们想要对应着Rocksoft模型中<code>Refin=FALSE</code>和<code>Refot=TRUE</code>，则只需要在<code>normal</code>的基础上，对其结果反射即可。而如果我们想要对应着Rocksoft模型中<code>Refin=TRUE</code>和<code>Refot=FALSE</code>，则只需要在<code>reflected</code>的基础上，对其结果进行反射即可。</p>
<p>一个32比特的CRC算法以及其reflected的其示例代码如下：</p>
<figure class="highlight c"><figcaption><span>crc32_table_driven.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// crc-32 parameter</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> XOROT 0Xffffffff</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INIT 0Xffffffff</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INIT_REFLECTED 0Xffffffff</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CHECK 0XCBF43926</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// this table is generated by crctable.c using crc-32 parameter</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;crctable&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 32-bit normal form (the 16-bit form is similar).</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">crc_normal</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* blk_adr, <span class="type">unsigned</span> <span class="type">long</span> blk_len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> crc = INIT;</span><br><span class="line">    <span class="keyword">while</span> (blk_len--)</span><br><span class="line">        crc = crctable[((crc &gt;&gt; <span class="number">24</span>) ^ *blk_adr++) &amp; <span class="number">0xFF</span>L] ^ (crc &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> crc ^ XOROT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Here is the reflected form:</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">crc_reflected</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* blk_adr, <span class="type">unsigned</span> <span class="type">long</span> blk_len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> crc = INIT_REFLECTED;</span><br><span class="line">    <span class="keyword">while</span> (blk_len--)</span><br><span class="line">        crc = crctable[(crc ^ *blk_adr++) &amp; <span class="number">0xFF</span>L] ^ (crc &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> crc ^ XOROT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// check for validating</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Check Algorithm by \&quot;123456789\&quot;\n&quot;</span>);</span><br><span class="line">    <span class="type">char</span>* message = <span class="string">&quot;123456789&quot;</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> res = crc_reflected((<span class="type">unsigned</span> <span class="type">char</span> *)message, <span class="built_in">strlen</span>(message));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;crc result: %lx \n&quot;</span>, res);</span><br><span class="line">    assert(res == CHECK);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\e[1;32mCheck Pass !!!\e[0m\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="生成查找表">生成查找表</h1>
<p>上一节中的代码片段中中唯一缺少的组件是查找表。查找表可以在运行时使用前面给出的模型包的<code>cm_tab</code>函数计算，也可以预先计算并插入到C程序中。在任何一种情况下，都应该注意，查找表仅取决于POLY和RefIn参数。</p>
<p>下面的程序可以生成任何所需的32位或者16位查找表：</p>
<figure class="highlight c"><figcaption><span>crctable.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                             Start of crctable.c                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Author  : Ross Williams (ross@guest.adelaide.edu.au.).                     */</span></span><br><span class="line"><span class="comment">/* Date    : 3 June 1993.                                                     */</span></span><br><span class="line"><span class="comment">/* Version : 1.0.                                                             */</span></span><br><span class="line"><span class="comment">/* Status  : Public domain.                                                   */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Description : This program writes a CRC lookup table (suitable for         */</span></span><br><span class="line"><span class="comment">/* inclusion in a C program) to a designated output file. The program can be  */</span></span><br><span class="line"><span class="comment">/* statically configured to produce any table covered by the Rocksoft^tm      */</span></span><br><span class="line"><span class="comment">/* Model CRC Algorithm. For more information on the Rocksoft^tm Model CRC     */</span></span><br><span class="line"><span class="comment">/* Algorithm, see the document titled &quot;A Painless Guide to CRC Error          */</span></span><br><span class="line"><span class="comment">/* Detection Algorithms&quot; by Ross Williams (ross@guest.adelaide.edu.au.). This */</span></span><br><span class="line"><span class="comment">/* document is likely to be in &quot;ftp.adelaide.edu.au/pub/rocksoft&quot;.            */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Note: Rocksoft is a trademark of Rocksoft Pty Ltd, Adelaide, Australia.    */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;crcmodel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* TABLE PARAMETERS                                                           */</span></span><br><span class="line"><span class="comment">/* ================                                                           */</span></span><br><span class="line"><span class="comment">/* The following parameters entirely determine the table to be generated. You */</span></span><br><span class="line"><span class="comment">/* should need to modify only the definitions in this section before running  */</span></span><br><span class="line"><span class="comment">/* this program.                                                              */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/*    TB_FILE  is the name of the output file.                                */</span></span><br><span class="line"><span class="comment">/*    TB_WIDTH is the table width in bytes (either 2 or 4).                   */</span></span><br><span class="line"><span class="comment">/*    TB_POLY  is the &quot;polynomial&quot;, which must be TB_WIDTH bytes wide.        */</span></span><br><span class="line"><span class="comment">/*    TB_REVER indicates whether the table is to be reversed (reflected).     */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/* Example:                                                                   */</span></span><br><span class="line"><span class="comment">/*                                                                            */</span></span><br><span class="line"><span class="comment">/*    #define TB_FILE   &quot;crctable.out&quot;                                        */</span></span><br><span class="line"><span class="comment">/*    #define TB_WIDTH  2                                                     */</span></span><br><span class="line"><span class="comment">/*    #define TB_POLY   0x8005L                                               */</span></span><br><span class="line"><span class="comment">/*    #define TB_REVER  TRUE                                                  */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// crc-32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TB_FILE <span class="string">&quot;crctable&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TB_WIDTH 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TB_POLY 0x04C11DB7L</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TB_REVER TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Miscellaneous definitions. */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOCAL static</span></span><br><span class="line">FILE* outfile;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WR(X) fprintf(outfile, (X))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WP(X, Y) fprintf(outfile, (X), (Y))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* If mess is non-empty, write it out and abort. Otherwise, check the error   */</span></span><br><span class="line"><span class="comment">/* status of outfile and abort if an error has occurred.                      */</span></span><br><span class="line">LOCAL <span class="type">void</span> <span class="title function_">chk_err</span><span class="params">(<span class="type">char</span>*)</span>;</span><br><span class="line">LOCAL <span class="type">void</span> <span class="title function_">chk_err</span><span class="params">(<span class="type">char</span>* mess)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (mess[<span class="number">0</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, mess);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ferror(outfile)) &#123;</span><br><span class="line">        perror(<span class="string">&quot;chk_err&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line">LOCAL <span class="type">void</span> <span class="title function_">chkparam</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">LOCAL <span class="type">void</span> <span class="title function_">chkparam</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((TB_WIDTH != <span class="number">2</span>) &amp;&amp; (TB_WIDTH != <span class="number">4</span>))</span><br><span class="line">        chk_err(<span class="string">&quot;chkparam: Width parameter is illegal.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ((TB_WIDTH == <span class="number">2</span>) &amp;&amp; (TB_POLY &amp; <span class="number">0xFFFF0000</span>L))</span><br><span class="line">        chk_err(<span class="string">&quot;chkparam: Poly parameter is too wide.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ((TB_REVER != FALSE) &amp;&amp; (TB_REVER != TRUE))</span><br><span class="line">        chk_err(<span class="string">&quot;chkparam: Reverse parameter is not boolean.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line">LOCAL <span class="type">void</span> <span class="title function_">gentable</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">LOCAL <span class="type">void</span> <span class="title function_">gentable</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    WR(<span class="string">&quot;/*****************************************************************/\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/*                                                               */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* CRC LOOKUP TABLE                                              */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* ================                                              */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* The following CRC lookup table was generated automagically    */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* by the Rocksoft^tm Model CRC Algorithm Table Generation       */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* Program V1.0 using the following model parameters:            */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/*                                                               */\n&quot;</span>);</span><br><span class="line">    WP(<span class="string">&quot;/*    Width   : %1lu bytes.                                         */\n&quot;</span>, (ulong)TB_WIDTH);</span><br><span class="line">    <span class="keyword">if</span> (TB_WIDTH == <span class="number">2</span>)</span><br><span class="line">        WP(<span class="string">&quot;/*    Poly    : 0x%04lX                                       */\n&quot;</span>,(ulong)TB_POLY);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        WP(<span class="string">&quot;/*    Poly    : 0x%08lXL                                      */\n&quot;</span>,(ulong)TB_POLY);</span><br><span class="line">    <span class="keyword">if</span> (TB_REVER)</span><br><span class="line">        WR(<span class="string">&quot;/*    Reverse : TRUE.                                            */\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        WR(<span class="string">&quot;/*    Reverse : FALSE.                                           */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/*                                                               */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* For more information on the Rocksoft^tm Model CRC Algorithm,  */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* see the document titled \&quot;A Painless Guide to CRC Error        */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* Detection Algorithms\&quot; by Ross Williams                        */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* (ross@guest.adelaide.edu.au.). This document is likely to be  */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/* in the FTP archive \&quot;ftp.adelaide.edu.au/pub/rocksoft\&quot;.        */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/*                                                               */\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;/*****************************************************************/\n&quot;</span>);</span><br><span class="line">    WR(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> (TB_WIDTH) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        WR(<span class="string">&quot;unsigned short crctable[256] =\n&#123;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        WR(<span class="string">&quot;unsigned long  crctable[256] =\n&#123;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        chk_err(<span class="string">&quot;gentable: TB_WIDTH is invalid.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    chk_err(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="type">cm_t</span> cm;</span><br><span class="line">        <span class="type">char</span>* form = (TB_WIDTH == <span class="number">2</span>) ? <span class="string">&quot;0x%04lX&quot;</span> : <span class="string">&quot;0x%08lXL&quot;</span>;</span><br><span class="line">        <span class="type">int</span> perline = (TB_WIDTH == <span class="number">2</span>) ? <span class="number">8</span> : <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        cm.cm_width = TB_WIDTH * <span class="number">8</span>;</span><br><span class="line">        cm.cm_poly = TB_POLY;</span><br><span class="line">        cm.cm_refin = TB_REVER;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">            WR(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            WP(form, (ulong)cm_tab(&amp;cm, i));</span><br><span class="line">            <span class="keyword">if</span> (i != <span class="number">255</span>)</span><br><span class="line">                WR(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (((i + <span class="number">1</span>) % perline) == <span class="number">0</span>)</span><br><span class="line">                WR(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            chk_err(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        WR(<span class="string">&quot;&#125;;\n&quot;</span>);</span><br><span class="line">        WR(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        WR(<span class="string">&quot;/*****************************************************************/\n&quot;</span>);</span><br><span class="line">        WR(<span class="string">&quot;/*                   End of CRC Lookup Table                     */\n&quot;</span>);</span><br><span class="line">        WR(<span class="string">&quot;/*****************************************************************/\n&quot;</span>);</span><br><span class="line">        WR(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        chk_err(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rocksoft^tm Model CRC Algorithm Table Generation Program V1.0\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------------------------------------------------------\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Output file is \&quot;%s\&quot;.\n&quot;</span>, TB_FILE);</span><br><span class="line">    chkparam();</span><br><span class="line">    outfile = fopen(TB_FILE, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    chk_err(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    gentable();</span><br><span class="line">    <span class="keyword">if</span> (fclose(outfile) != <span class="number">0</span>)</span><br><span class="line">        chk_err(<span class="string">&quot;main: Couldn&#x27;t close output file.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nSUCCESS: The table has been successfully written.\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"><span class="comment">/*                             End of crctable.c                              */</span></span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="可用参考">可用参考</h1>
<p>Boudreau, Steen, "Cyclic Redundancy Checking by Program," AFIPS Proceedings, Vol. 39, 1971.</p>
<p>Davies, Barber, "Computer Networks and Their Protocols," J. Wiley &amp; Sons, 1979.</p>
<p>Higginson, Kirstein, "On the Computation of Cyclic Redundancy Checks by Program," The Computer Journal (British), Vol. 16, No. 1, Feb 1973.</p>
<p>McNamara, J. E., "Technical Aspects of Data Communication," 2nd Edition, Digital Press, Bedford, Massachusetts, 1982.</p>
<p>Marton and Frambs, "A Cyclic Redundancy Checking (CRC) Algorithm," Honeywell Computer Journal, Vol. 5, No. 3, 1971.</p>
<p>Nelson M., "File verification using CRC", Dr Dobbs Journal, May 1992, pp.64-67.</p>
<p>Ramabadran T.V., Gaitonde S.S., "A tutorial on CRC computations", IEEE Micro, Aug 1988.</p>
<p>Schwaderer W.D., "CRC Calculation", April 85 PC Tech Journal, pp.118-133.</p>
<p>Ward R.K, Tabandeh M., "Error Correction and Detection, A Geometric Approach" The Computer Journal, Vol. 27, No. 3, 1984, pp.246-253.</p>
<p>Wecker, S., "A Table-Lookup Algorithm for Software Computation of Cyclic Redundancy Check (CRC)," Digital Equipment Corporation memorandum, 1974.</p>
<p>[Griffiths87]<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>[Knuth81]<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>[Nelson91]<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>[Sarwate88]<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>[Tanenbaum81]<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p>CRC除法的性质决定的，而二进制除法则会得到<span class="math inline">\(W+1\)</span>位的余数，因为除数的宽度是<span class="math inline">\(W+1\)</span><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Tanenbaum, A.S., "Computer Networks", Prentice Hall, 1981, ISBN: 0-13-164699-0. Comment: Section 3.5.3 on pages 128 to 132 provides a very clear description of CRC codes. However, it does not describe table-driven implementation techniques.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Griffiths, G., Carlyle Stones, G., "The Tea-Leaf Reader Algorithm: An Efficient Implementation of CRC-16 and CRC-32", Communications of the ACM, 30(7), pp.617-620. Comment: This paper describes a high-speed table-driven implementation of CRC algorithms. The technique seems to be a touch messy, and is superceded by the Sarwete algorithm.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>Knuth, D.E., "The Art of Computer Programming", Volume 2: Seminumerical Algorithms, Section 4.6.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>Nelson, M., "The Data Compression Book", M&amp;T Books, (501 Galveston Drive, Redwood City, CA 94063), 1991, ISBN: 1-55851-214-4. Comment: If you want to see a real implementation of a real 32-bit checksum algorithm, look on pages 440, and 446-448.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>Sarwate, D.V., "Computation of Cyclic Redundancy Checks via Table Look-Up", Communications of the ACM, 31(8), pp.1008-1013. Comment: This paper describes a high-speed table-driven implementation for CRC algorithms that is superior to the tea-leaf algorithm. Although this paper describes the technique used by most modern CRC implementations, I found the appendix of this paper (where all the good stuff is) difficult to understand.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote"><p>Tanenbaum, A.S., "Computer Networks", Prentice Hall, 1981, ISBN: 0-13-164699-0. Comment: Section 3.5.3 on pages 128 to 132 provides a very clear description of CRC codes. However, it does not describe table-driven implementation techniques.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.narutozxp.top">narutozxp</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.narutozxp.top/2024/07/31/CRC%E6%A0%A1%E9%AA%8C%E8%AF%A6%E8%A7%A3/">https://www.narutozxp.top/2024/07/31/CRC%E6%A0%A1%E9%AA%8C%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.narutozxp.top" target="_blank">narutozxp</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CRC/">CRC</a></div><div class="post_share"><div class="social-share" data-image="/img/25.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/12/TLS%E6%8F%A1%E6%89%8B%E8%BF%87%E7%A8%8B/"><img class="prev-cover" src="/img/29.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">TLS握手流程</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/29/WaveDrom/"><img class="next-cover" src="/img/10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WaveDrom教程</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%91%98%E8%A6%81"><span class="toc-number">1.</span> <span class="toc-text">摘要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%A3%80%E6%B5%8B%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">2.</span> <span class="toc-text">错误检测的目的</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A0%E9%94%99%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">3.</span> <span class="toc-text">纠错复杂度</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#crc%E7%AE%97%E6%B3%95%E8%83%8C%E5%90%8E%E7%9A%84%E5%9F%BA%E7%A1%80%E6%80%9D%E6%83%B3"><span class="toc-number">4.</span> <span class="toc-text">CRC算法背后的基础思想</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E8%BF%90%E7%AE%97"><span class="toc-number">5.</span> <span class="toc-text">多项式运算</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%8E%AF"><span class="toc-number">5.1.</span> <span class="toc-text">多项式环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E4%B8%8A%E7%9A%84%E5%A4%9A%E9%A1%B9%E5%BC%8F%E9%99%A4%E6%B3%95"><span class="toc-number">5.2.</span> <span class="toc-text">域上的多项式除法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A0%E5%9F%9Fprime-field"><span class="toc-number">5.3.</span> <span class="toc-text">素域（Prime field）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%9F%9Fextension-field"><span class="toc-number">5.4.</span> <span class="toc-text">扩域（extension field）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crc%E5%A4%9A%E9%A1%B9%E5%BC%8F%E8%BF%90%E7%AE%97"><span class="toc-number">5.5.</span> <span class="toc-text">CRC多项式运算</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E8%BF%9B%E4%BD%8D%E4%BF%A1%E5%8F%B7%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%BF%90%E7%AE%97"><span class="toc-number">6.</span> <span class="toc-text">没有进位信号的二进制运算</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%8F%AF%E8%A1%8C%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">一个可行的示例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">8.</span> <span class="toc-text">多项式的选择</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E7%A7%8D%E7%AE%80%E5%8D%95%E7%9A%84crc%E5%AE%9E%E7%8E%B0simple"><span class="toc-number">9.</span> <span class="toc-text">一种简单的CRC实现（SIMPLE）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A1%A8%E7%9A%84crc%E5%AE%9E%E7%8E%B0table-algorithm"><span class="toc-number">10.</span> <span class="toc-text">基于表的CRC实现（TABLE ALGORITHM）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A1%A8%E7%9A%84crc%E5%AE%9E%E7%8E%B0direct-table-algorithm"><span class="toc-number">11.</span> <span class="toc-text">基于表的CRC实现（DIRECT TABLE ALGORITHM）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reflected-algorithm"><span class="toc-number">12.</span> <span class="toc-text">REFLECTED algorithm</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%8F%8D%E8%BD%ACreversed-polys"><span class="toc-number">13.</span> <span class="toc-text">多项式反转（Reversed Polys）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%9C%80%E7%BB%88%E5%80%BC"><span class="toc-number">14.</span> <span class="toc-text">初始化和最终值</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">15.</span> <span class="toc-text">算法的定义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#crc%E5%8F%82%E6%95%B0%E5%8C%96%E6%A8%A1%E5%9E%8Brocksoft"><span class="toc-number">16.</span> <span class="toc-text">CRC参数化模型（Rocksoft™）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rocksoft%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%8F%82%E8%80%83%E5%AE%9E%E7%8E%B0"><span class="toc-number">17.</span> <span class="toc-text">Rocksoft™模型的参考实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A1%A8%E7%9A%84crc%E5%AE%9E%E7%8E%B0"><span class="toc-number">18.</span> <span class="toc-text">基于表的CRC实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%9F%A5%E6%89%BE%E8%A1%A8"><span class="toc-number">19.</span> <span class="toc-text">生成查找表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E5%8F%82%E8%80%83"><span class="toc-number">20.</span> <span class="toc-text">可用参考</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid@10.2.3/dist/mermaid.min.js"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-vercel-gray.vercel.app',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-vercel-gray.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo@1/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.jsdelivr.net/gh/narutozxp/live2d-widget@2.1.4/autoload.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>